<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>后端开发文档 | M18 Developer Center</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Make Something People Want">
    
    <link rel="preload" href="/assets/css/0.styles.8a6fbabe.css" as="style"><link rel="preload" href="/assets/js/app.cac8883f.js" as="script"><link rel="preload" href="/assets/js/2.09bf837d.js" as="script"><link rel="preload" href="/assets/js/20.d4c305df.js" as="script"><link rel="prefetch" href="/assets/js/10.d76219f3.js"><link rel="prefetch" href="/assets/js/100.8df6fafd.js"><link rel="prefetch" href="/assets/js/101.40750a48.js"><link rel="prefetch" href="/assets/js/102.c9db701c.js"><link rel="prefetch" href="/assets/js/103.aac0139b.js"><link rel="prefetch" href="/assets/js/104.ff2a29e5.js"><link rel="prefetch" href="/assets/js/105.30dc470e.js"><link rel="prefetch" href="/assets/js/106.4558ba01.js"><link rel="prefetch" href="/assets/js/107.5c537f83.js"><link rel="prefetch" href="/assets/js/108.277d4902.js"><link rel="prefetch" href="/assets/js/109.e1619c00.js"><link rel="prefetch" href="/assets/js/11.521febae.js"><link rel="prefetch" href="/assets/js/110.ee769308.js"><link rel="prefetch" href="/assets/js/111.1c300294.js"><link rel="prefetch" href="/assets/js/112.957f018e.js"><link rel="prefetch" href="/assets/js/113.df212c56.js"><link rel="prefetch" href="/assets/js/114.a3f993c1.js"><link rel="prefetch" href="/assets/js/12.91470827.js"><link rel="prefetch" href="/assets/js/13.81a71d87.js"><link rel="prefetch" href="/assets/js/14.ae49663a.js"><link rel="prefetch" href="/assets/js/15.ac0a6cae.js"><link rel="prefetch" href="/assets/js/16.0d87a4c0.js"><link rel="prefetch" href="/assets/js/17.e5dc87ac.js"><link rel="prefetch" href="/assets/js/18.f25d47ca.js"><link rel="prefetch" href="/assets/js/19.5a3340b9.js"><link rel="prefetch" href="/assets/js/21.aef9bae6.js"><link rel="prefetch" href="/assets/js/22.b049dee7.js"><link rel="prefetch" href="/assets/js/23.758207ea.js"><link rel="prefetch" href="/assets/js/24.559c1f6d.js"><link rel="prefetch" href="/assets/js/25.91bb65a7.js"><link rel="prefetch" href="/assets/js/26.0a776726.js"><link rel="prefetch" href="/assets/js/27.066ae84e.js"><link rel="prefetch" href="/assets/js/28.3cbec560.js"><link rel="prefetch" href="/assets/js/29.32e0d9ae.js"><link rel="prefetch" href="/assets/js/3.5953f733.js"><link rel="prefetch" href="/assets/js/30.35edd2c9.js"><link rel="prefetch" href="/assets/js/31.cd658b92.js"><link rel="prefetch" href="/assets/js/32.9b377ef5.js"><link rel="prefetch" href="/assets/js/33.43261653.js"><link rel="prefetch" href="/assets/js/34.230d6cb1.js"><link rel="prefetch" href="/assets/js/35.2c806e44.js"><link rel="prefetch" href="/assets/js/36.3df42eb6.js"><link rel="prefetch" href="/assets/js/37.08877b80.js"><link rel="prefetch" href="/assets/js/38.d379f58e.js"><link rel="prefetch" href="/assets/js/39.677f229b.js"><link rel="prefetch" href="/assets/js/4.23211b6a.js"><link rel="prefetch" href="/assets/js/40.9226cdcc.js"><link rel="prefetch" href="/assets/js/41.296ae2b7.js"><link rel="prefetch" href="/assets/js/42.d072fd41.js"><link rel="prefetch" href="/assets/js/43.f9c0ac65.js"><link rel="prefetch" href="/assets/js/44.bd9dbe1b.js"><link rel="prefetch" href="/assets/js/45.c002f09a.js"><link rel="prefetch" href="/assets/js/46.2a962c4b.js"><link rel="prefetch" href="/assets/js/47.3b8210bb.js"><link rel="prefetch" href="/assets/js/48.019123ee.js"><link rel="prefetch" href="/assets/js/49.59f9516f.js"><link rel="prefetch" href="/assets/js/5.50fb86ee.js"><link rel="prefetch" href="/assets/js/50.c0ea525d.js"><link rel="prefetch" href="/assets/js/51.9197e3e7.js"><link rel="prefetch" href="/assets/js/52.88a1acf0.js"><link rel="prefetch" href="/assets/js/53.f401981d.js"><link rel="prefetch" href="/assets/js/54.7f0c2dbd.js"><link rel="prefetch" href="/assets/js/55.d5249ca8.js"><link rel="prefetch" href="/assets/js/56.1e7cf71f.js"><link rel="prefetch" href="/assets/js/57.0cdbff37.js"><link rel="prefetch" href="/assets/js/58.6458d18d.js"><link rel="prefetch" href="/assets/js/59.b506e268.js"><link rel="prefetch" href="/assets/js/6.e5a82ef8.js"><link rel="prefetch" href="/assets/js/60.224b7d65.js"><link rel="prefetch" href="/assets/js/61.655a6656.js"><link rel="prefetch" href="/assets/js/62.62aee5e4.js"><link rel="prefetch" href="/assets/js/63.984b7f1d.js"><link rel="prefetch" href="/assets/js/64.378c828d.js"><link rel="prefetch" href="/assets/js/65.35151ec3.js"><link rel="prefetch" href="/assets/js/66.850f6dee.js"><link rel="prefetch" href="/assets/js/67.0a3f2e0a.js"><link rel="prefetch" href="/assets/js/68.952d2b2a.js"><link rel="prefetch" href="/assets/js/69.0940f4e2.js"><link rel="prefetch" href="/assets/js/7.96df806c.js"><link rel="prefetch" href="/assets/js/70.58c35aca.js"><link rel="prefetch" href="/assets/js/71.34a1142d.js"><link rel="prefetch" href="/assets/js/72.6cda9e6a.js"><link rel="prefetch" href="/assets/js/73.08259444.js"><link rel="prefetch" href="/assets/js/74.c6dedd8c.js"><link rel="prefetch" href="/assets/js/75.5684227d.js"><link rel="prefetch" href="/assets/js/76.c8490eca.js"><link rel="prefetch" href="/assets/js/77.6f1451be.js"><link rel="prefetch" href="/assets/js/78.447b7cad.js"><link rel="prefetch" href="/assets/js/79.82343f6c.js"><link rel="prefetch" href="/assets/js/8.19aa3fde.js"><link rel="prefetch" href="/assets/js/80.a300bd94.js"><link rel="prefetch" href="/assets/js/81.b3213c65.js"><link rel="prefetch" href="/assets/js/82.53573e50.js"><link rel="prefetch" href="/assets/js/83.7d87fa68.js"><link rel="prefetch" href="/assets/js/84.5adca039.js"><link rel="prefetch" href="/assets/js/85.ecd88cf7.js"><link rel="prefetch" href="/assets/js/86.10093a71.js"><link rel="prefetch" href="/assets/js/87.73db365e.js"><link rel="prefetch" href="/assets/js/88.fafb8f80.js"><link rel="prefetch" href="/assets/js/89.fa7b6e2e.js"><link rel="prefetch" href="/assets/js/9.36971757.js"><link rel="prefetch" href="/assets/js/90.5859a97a.js"><link rel="prefetch" href="/assets/js/91.9c9cfe4c.js"><link rel="prefetch" href="/assets/js/92.15f57c5d.js"><link rel="prefetch" href="/assets/js/93.90db2daa.js"><link rel="prefetch" href="/assets/js/94.a6180d38.js"><link rel="prefetch" href="/assets/js/95.6d3450b7.js"><link rel="prefetch" href="/assets/js/96.41c09226.js"><link rel="prefetch" href="/assets/js/97.09783852.js"><link rel="prefetch" href="/assets/js/98.0babcf28.js"><link rel="prefetch" href="/assets/js/99.6b06a072.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8a6fbabe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">M18 Developer Center</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/tutorial/" class="nav-link">
  Tutorial
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebServices" class="dropdown-title"><span class="title">WebServices</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebServices" class="mobile-dropdown-title"><span class="title">WebServices</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/api/m18/" class="nav-link">
  M18
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ce01/" class="nav-link">
  M18 ERP
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ch01/" class="nav-link">
  M18 HCM
</a></li></ul></div></div><div class="nav-item"><a href="/en/m18/" class="nav-link">
  App
</a></div><div class="nav-item"><a href="/zh-CN/" class="nav-link router-link-active">
  中文文档
</a></div><div class="nav-item"><a href="https://community.multiable.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Community
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/tutorial/" class="nav-link">
  Tutorial
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebServices" class="dropdown-title"><span class="title">WebServices</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebServices" class="mobile-dropdown-title"><span class="title">WebServices</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/api/m18/" class="nav-link">
  M18
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ce01/" class="nav-link">
  M18 ERP
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ch01/" class="nav-link">
  M18 HCM
</a></li></ul></div></div><div class="nav-item"><a href="/en/m18/" class="nav-link">
  App
</a></div><div class="nav-item"><a href="/zh-CN/" class="nav-link router-link-active">
  中文文档
</a></div><div class="nav-item"><a href="https://community.multiable.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Community
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端开发文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh-CN/m18/backend_doc.html#逻辑模块" class="sidebar-link">逻辑模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#模块的curd" class="sidebar-link">模块的CURD</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#checker与事务" class="sidebar-link">Checker与事务</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#操作非模块数据" class="sidebar-link">操作非模块数据</a></li></ul></li><li><a href="/zh-CN/m18/backend_doc.html#系统表描述" class="sidebar-link">系统表描述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#系统表关键字规范" class="sidebar-link">系统表关键字规范</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#datadict-xml" class="sidebar-link">datadict.xml</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#pattern-xml" class="sidebar-link">pattern.xml</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#navmenu-xml" class="sidebar-link">navmenu.xml</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#module-xml" class="sidebar-link">module.xml</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#i18n的实现" class="sidebar-link">i18n的实现</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#search的实现" class="sidebar-link">Search的实现</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#stinfo-xml" class="sidebar-link">stInfo.xml</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#stsearch-xml" class="sidebar-link">stSearch.xml</a></li></ul></li><li><a href="/zh-CN/m18/backend_doc.html#权限控制" class="sidebar-link">权限控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#影响登录" class="sidebar-link">影响登录</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#模块权限" class="sidebar-link">模块权限</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#单据权限" class="sidebar-link">单据权限</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#字段权限" class="sidebar-link">字段权限</a></li></ul></li><li><a href="/zh-CN/m18/backend_doc.html#常用功能" class="sidebar-link">常用功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#关于配置文件" class="sidebar-link">关于配置文件</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#表结构信息" class="sidebar-link">表结构信息</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#导入与导出" class="sidebar-link">导入与导出</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#文档打印" class="sidebar-link">文档打印</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#自定义模块" class="sidebar-link">自定义模块</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#初始化数据" class="sidebar-link">初始化数据</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#数据修复" class="sidebar-link">数据修复</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#如何新增jar" class="sidebar-link">如何新增jar</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#定位启动错误" class="sidebar-link">定位启动错误</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#定时任务" class="sidebar-link">定时任务</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#文件流的处理方式" class="sidebar-link">文件流的处理方式</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#集群cache同步" class="sidebar-link">集群Cache同步</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#object共享" class="sidebar-link">Object共享</a></li></ul></li><li><a href="/zh-CN/m18/backend_doc.html#常用工具类" class="sidebar-link">常用工具类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#基本操作" class="sidebar-link">基本操作</a></li><li class="sidebar-sub-header"><a href="/zh-CN/m18/backend_doc.html#特定操作" class="sidebar-link">特定操作</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="后端开发文档"><a href="#后端开发文档" class="header-anchor">#</a> 后端开发文档</h1> <h2 id="逻辑模块"><a href="#逻辑模块" class="header-anchor">#</a> 逻辑模块</h2> <h3 id="模块的curd"><a href="#模块的curd" class="header-anchor">#</a> 模块的CURD</h3> <p>M18系统提供了基本模块的操作接口，设计通用型的接口最大的目的在于可以批量化处理。</p> <h4 id="使用web-service"><a href="#使用web-service" class="header-anchor">#</a> 使用Web Service</h4> <ul><li>创建Entity</li></ul> <p>获取当前模块的空Entity</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">WsParameter</span> param <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">createWsParam</span><span class="token punctuation">(</span><span class="token string">&quot;entity/create/&quot;</span> <span class="token operator">+</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">WsType</span><span class="token punctuation">.</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span>
param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;menuCode&quot;</span><span class="token punctuation">,</span> <span class="token function">getMenuCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">callWs</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">isResponseOK</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> entryJson <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">resolveResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FacesUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>entryJson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">SqlEntity</span>  result <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>entryJson<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">showMessageInfo</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;createFail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>HTTP 请求</p></blockquote> <p><code>POST http://[server]/jsf/rfws/entity/create/[module]?menuCode=[menuCode]</code></p> <blockquote><p>参数</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>module</td> <td><code>String</code>(<em>Path</em>)</td> <td>**必填.**当前模块的名称</td></tr> <tr><td>menuCode</td> <td><code>String</code>(<em>Query</em>)</td> <td>**必填.**当前菜单的名称</td></tr> <tr><td>param</td> <td><code>json String</code>(<em>Query</em>)</td> <td>如果当前模块有一些特殊的逻辑需要处理，可以传入一个json的参数到checker进行处理；</td></tr></tbody></table> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回的结果是成功的, 可以拿到一个当前模块的空SqlEntity.</p> <p><strong>注</strong>: 如果返回的结果是失败的, 可以在返回的response header中通过key‘error_info’拿到一个CheckMsg的json数组；</p> <table><thead><tr><th>类型</th> <th>位置</th> <th>说明</th></tr></thead> <tbody><tr><td><code>成功</code></td> <td><em>Body</em></td> <td>模块的空SqlEntity</td></tr> <tr><td><code>失败</code></td> <td><em>Header</em>(error_info)</td> <td>CheckMsg的json数组</td></tr></tbody></table> <ul><li>读取Entity</li></ul> <p>读取当前模块的已存在的SqlEntity</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">WsParameter</span> param <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">createWsParam</span><span class="token punctuation">(</span><span class="token string">&quot;entity/read/&quot;</span> <span class="token operator">+</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">WsType</span><span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;menuCode&quot;</span><span class="token punctuation">,</span> <span class="token function">getMenuCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">ActionParam</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;iRev&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">.</span><span class="token function">getDataOrDefault</span><span class="token punctuation">(</span><span class="token class-name">ActionParam</span><span class="token punctuation">.</span>iRev<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">callWs</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">isResponseOK</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">String</span> entryJson <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">resolveResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FacesUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>entryJson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				entity <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>entryJson<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">showMessageInfo</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;readFail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>HTTP 请求</p></blockquote> <p><code>GET http://[server]/jsf/rfws/entity/create/[module]?menuCode=[menuCode]&amp;id=[id]</code></p> <blockquote><p>参数</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>module</td> <td><code>String</code>(<em>Path</em>)</td> <td>**必填.**当前模块的名称</td></tr> <tr><td>menuCode</td> <td><code>String</code>(<em>Query</em>)</td> <td>**必填.**当前菜单的名称</td></tr> <tr><td>param</td> <td><code>json String</code>(<em>Query</em>)</td> <td>如果当前模块有一些特殊的逻辑需要处理，可以传入一个json的参数到checker进行处理；</td></tr> <tr><td>id</td> <td><code>long</code>(<em>Query</em>)</td> <td>**必填.**需要读取entity的id</td></tr> <tr><td>iRev</td> <td>int（Query）</td> <td>如果是要读取旧版本，请传入正确的版本号；如果读取最新版本，iRev可以不填或填0</td></tr></tbody></table> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回的结果是成功的, 可以拿到一个当前模块的正确SqlEntity.
<strong>注</strong>: 如果返回的结果是失败的, 可以在返回的response header中通过key‘error_info’拿到一个CheckMsg的json数组；</p> <table><thead><tr><th>类型</th> <th>位置</th> <th>说明</th></tr></thead> <tbody><tr><td><code>成功</code></td> <td><em>Body</em></td> <td>模块的正确SqlEntity</td></tr> <tr><td><code>失败</code></td> <td><em>Header</em>(error_info)</td> <td>CheckMsg的json数组</td></tr></tbody></table> <ul><li>保存Entity</li></ul> <p>保存当前模块的SqlEntity</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">WsParameter</span> param <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">createWsParam</span><span class="token punctuation">(</span><span class="token string">&quot;entity/save/&quot;</span> <span class="token operator">+</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">WsType</span><span class="token punctuation">.</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span>

		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;menuCode&quot;</span><span class="token punctuation">,</span> <span class="token function">getMenuCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;entity&quot;</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">callWs</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">isResponseOK</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">long</span> recordId <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span><span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">resolveResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			action<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">ActionParam</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> recordId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">showMessageInfo</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token string">&quot;saveSuccess&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;saveFail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>HTTP 请求</p></blockquote> <p><code>PUT http://[server]/jsf/rfws/entity/save/[module]?menuCode=[menuCode]&amp;entity=[SqlEntity json String]</code></p> <blockquote><p>参数</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>module</td> <td><code>String</code>(<em>Path</em>)</td> <td>**必填.**当前模块的名称</td></tr> <tr><td>menuCode</td> <td><code>String</code>(<em>Query</em>)</td> <td>**必填.**当前菜单的名称</td></tr> <tr><td>param</td> <td><code>json String</code>(<em>Query</em>)</td> <td>如果当前模块有一些特殊的逻辑需要处理，可以传入一个json的参数到checker进行处理；</td></tr> <tr><td>entity</td> <td><code>jsonString</code>(<em>Query</em>)</td> <td>**必填.**SqlEntity 的JSON String</td></tr></tbody></table> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回的结果是成功的, 可以拿到保存的SqlEntity的id.
<strong>注</strong>: 如果返回的结果是失败的, 可以在返回的response header中通过key‘error_info’拿到一个CheckMsg的json数组；</p> <table><thead><tr><th>类型</th> <th>位置</th> <th>说明</th></tr></thead> <tbody><tr><td><code>成功</code></td> <td><em>Body</em></td> <td>模块SqlEntity的id</td></tr> <tr><td><code>失败</code></td> <td><em>Header</em>(error_info)</td> <td>CheckMsg的json数组</td></tr></tbody></table> <ul><li>删除Entity</li></ul> <p>读取当前模块的已存在的SqlEntity</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">WsParameter</span> param <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">createWsParam</span><span class="token punctuation">(</span><span class="token string">&quot;entity/delete/&quot;</span> <span class="token operator">+</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">WsType</span><span class="token punctuation">.</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span>

		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;menuCode&quot;</span><span class="token punctuation">,</span> <span class="token function">getMenuCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">addQueryParam</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">ActionParam</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> <span class="token class-name">WsLib</span><span class="token punctuation">.</span><span class="token function">callWs</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">showMessageInfo</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token string">&quot;deleteSuccess&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deleteFail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>HTTP 请求</p></blockquote> <p><code>DELETE http://[server]/jsf/rfws/entity/delete/[module]?menuCode=[menuCode]&amp;id=[id]</code></p> <blockquote><p>参数</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>module</td> <td><code>String</code>(<em>Path</em>)</td> <td>**必填.**当前模块的名称</td></tr> <tr><td>menuCode</td> <td><code>String</code>(<em>Query</em>)</td> <td>**必填.**当前菜单的名称</td></tr> <tr><td>param</td> <td><code>json String</code>(<em>Query</em>)</td> <td>如果当前模块有一些特殊的逻辑需要处理，可以传入一个json的参数到checker进行处理；</td></tr> <tr><td>id</td> <td><code>long</code>(<em>Query</em>)</td> <td>**必填.**需要删除entity的id</td></tr></tbody></table> <blockquote><p>返回结果</p></blockquote> <blockquote><p>如果返回的结果是失败的, 可以在返回的response header中通过key‘error_info’拿到一个CheckMsg的json数组；</p></blockquote> <table><thead><tr><th>类型</th> <th>位置</th> <th>说明</th></tr></thead> <tbody><tr><td><code>成功</code></td> <td><em>Status</em></td> <td>Status是200代表成功</td></tr> <tr><td><code>失败</code></td> <td><em>Header</em>(error_info)</td> <td>CheckMsg的json数组</td></tr></tbody></table> <h4 id="直接使用ejb"><a href="#直接使用ejb" class="header-anchor">#</a> 直接使用EJB</h4> <ul><li>创建Entity</li></ul> <p>和Web Service 的方式相比，EJB的方式不会使用cache；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token class-name">CawEntityCurdAction</span> curdEJB<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">module</span>，string menuCode<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">SeCreateParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeCreateParam</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  param<span class="token punctuation">.</span><span class="token function">setMenuCode</span><span class="token punctuation">(</span>menuCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">EntityResult</span> result <span class="token operator">=</span> curdEJB<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>参数SeCreateParam</p></blockquote> <p>只需传入模块的名称和菜单的名称；</p> <p>如果当前模块有一些特殊的逻辑需要处理，可以将参数写入SeCreateParam的jsonParam里面，在checker进行处理；</p> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回EntityResult的SqlEntity不为null，则获取到模块的空SqlEntity</p> <p><strong>注</strong>: 如果返回EntityResult的SqlEntity为null，则查看里面的<code>List&lt;checkMsg&gt;</code> 得到错误信息；</p> <ul><li>读取Entity</li></ul> <p>和Web Service 的方式相比，EJB的方式不会使用cache；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token class-name">CawEntityCurdAction</span> curdEJB<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">module</span><span class="token punctuation">,</span> <span class="token class-name">String</span> menuCode<span class="token punctuation">,</span> <span class="token keyword">long</span> id<span class="token punctuation">,</span> <span class="token keyword">int</span> iRev<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token class-name">SeReadParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeReadParam</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setMenuCode</span><span class="token punctuation">(</span>menuCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

		param<span class="token punctuation">.</span><span class="token function">setEntityId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setIrev</span><span class="token punctuation">(</span>iRev<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">EntityResult</span> result <span class="token operator">=</span> curdEJB<span class="token punctuation">.</span><span class="token function">loadEntity</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>参数SeReadParam</p></blockquote> <p>只需传入模块的名称，菜单的名称，对应SqlEntity的id，如果需要查询旧版本，就传入iRev；</p> <p>如果当前模块有一些特殊的逻辑需要处理，可以将参数写入SeReadParam的jsonParam里面，在checker进行处理；</p> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回EntityResult的SqlEntity不为null，则获取到模块的正确SqlEntity</p> <p><strong>注</strong>: 如果返回EntityResult的SqlEntity为null，则查看里面的<code>List&lt;checkMsg&gt;</code> 得到错误信息；</p> <ul><li>保存Entity</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token class-name">CawEntityCurdAction</span> curdEJB<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">module</span><span class="token punctuation">,</span> <span class="token class-name">String</span> menuCode<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> entity<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">SeSaveParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeSaveParam</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setMenuCode</span><span class="token punctuation">(</span>menuCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setSqlEntity</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setInsertMir</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">CheckResult</span> result <span class="token operator">=</span> curdEJB<span class="token punctuation">.</span><span class="token function">updateEntity</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>参数SeSaveParam</p></blockquote> <p>只需传入模块的名称，菜单的名称，对应SqlEntity，还有如果要将旧数据写入旧数据表，请设置insertMir 为true；</p> <p>如果当前模块有一些特殊的逻辑需要处理，可以将参数写入的jsonParam里面，在checker进行处理；</p> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回CheckResult的pass为true，则保存成功，可以通过result的getEntityId()获取SqlEntity的id</p> <p><strong>注</strong>: 如果返回CheckResult的pass为false，则查看里面的<code>List&lt;checkMsg&gt;</code> 得到错误信息；</p> <ul><li>删除Entity</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token class-name">CawEntityCurdAction</span> curdEJB<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">module</span><span class="token punctuation">,</span> <span class="token class-name">String</span> menuCode<span class="token punctuation">,</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">SeDeleteParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeDeleteParam</span><span class="token punctuation">(</span><span class="token keyword">module</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setMenuCode</span><span class="token punctuation">(</span>menuCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setEntityId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		param<span class="token punctuation">.</span><span class="token function">setInsertMir</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token class-name">CheckResult</span> result <span class="token operator">=</span> curdEJB<span class="token punctuation">.</span><span class="token function">deleteEntity</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>参数SeDeleteParam</p></blockquote> <p>只需传入模块的名称，菜单的名称，对应SqlEntity的id，还有如果要将旧数据写入旧数据表，请设置insertMir 为true；</p> <p>如果当前模块有一些特殊的逻辑需要处理，可以将参数写入的jsonParam里面，在checker进行处理；</p> <blockquote><p>返回结果</p></blockquote> <p><strong>注</strong>: 如果返回CheckResult的pass为true，则删除成功，</p> <p><strong>注</strong>: 如果返回CheckResult的pass为false，则查看里面的<code>List&lt;checkMsg&gt;</code> 得到错误信息；</p> <h3 id="checker与事务"><a href="#checker与事务" class="header-anchor">#</a> Checker与事务</h3> <p>模块Curd过程中，可以通过checker进行一些检查或者其他操作；checker在<a href="#module.xml#">module.xml</a>中配置</p> <p>**checker方法的设置：**在module.xml配置的check类中定义方法，方法有@EntityCheck的注释，方法的参数只有一个：SeCurdParam</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeChecker</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@EntityCheck</span><span class="token punctuation">(</span>range <span class="token operator">=</span> <span class="token class-name">CheckRange</span><span class="token punctuation">.</span>BEFORE<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">CheckType</span><span class="token punctuation">.</span>SAVE<span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">CheckMsg</span> <span class="token function">checkMothed</span><span class="token punctuation">(</span><span class="token class-name">SeCurdParam</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span>；
	<span class="token punctuation">}</span>
</code></pre></div><p>@EntityCheck参数介绍</p> <table><thead><tr><th>名称</th> <th>必填</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>type</td> <td>ture</td> <td>CheckType</td> <td>Check有四种类型，分别是SAVE(1), DELETE(2), CREATE(3), READ(4);分别对应curd的四种操作</td></tr> <tr><td>range</td> <td>true</td> <td>CheckRange</td> <td>CheckRange有六种类型，BEFORE(1),AFTER(2),BOTH(3),SAVING(4),ROLLBACK(5）），DELETEING(6);其中SAVING只能在保存的时候使用；DELETEING只能在删除的时候使用；</td></tr> <tr><td>checkOrder</td> <td>false</td> <td>int</td> <td>默认为0，数值越小，越先执行；</td></tr> <tr><td>actionBreaker</td> <td>false</td> <td>boolean</td> <td>默认为false，如果设置为true；当check方法运行返回错误时，会立刻终止操作程，返回结果</td></tr> <tr><td>overrideMethod</td> <td>false</td> <td>String</td> <td>可以使用Class.method 的方式去覆盖其他Checker的method；</td></tr></tbody></table> <p><strong>保存的过程</strong></p> <ol><li><p>curdEJb调用Save方法；</p></li> <li><p>运行标志了CheckType =SAVE，CheckRange =BEFORE或者CheckRange =BOTH的方法，如果有其中一个方法返回的CheckMsg 不通过，就返回错误信息，不继续保存的操作；这个时候的check方法以查询为主，主要是检查数据的准确性，不会做一些修改数据库的操作；因为这个时候还没有在save的事务里面；</p></li> <li><p>如果Save-Before没有错误返回，将进入save的事务，先从SeSaveParam.getSqlBeforeDtos()取出sql List，逐一运行List的sql，getSqlBeforeDtos()里面的信息，一般是从before Check写入；发生错误后，将中断事务，运行</p></li></ol> <p>CheckType =SAVE，CheckRange =ROLLBACK的checker方法；然后返回错误信息；</p> <ol start="4"><li><p>如果sql Before没有发生错误，将继续下一步，将entity保存到数据库，保存到数据库的过程如果发生错误，将中断事务，运行CheckType =SAVE，CheckRange =ROLLBACK的checker方法；然后返回错误信息；</p></li> <li><p>将entity保存到数据库后，下一步运行CheckType =SAVE，CheckRange =SAVING的checker方法；如果发生错误，将中断事务，运行CheckType =SAVE，CheckRange =ROLLBACK的checker方法；然后返回错误信息；</p></li> <li><p>.如果SAVING的Checker没有错误，将从SeSaveParam.getSqlAfterDtos()取出sql List，逐一运行List的sql，getSqlAfterDtos()里面的信息；发生错误后，将中断事务，运行</p></li></ol> <p>CheckType =SAVE，CheckRange =ROLLBACK的checker方法；然后返回错误信息；</p> <ol start="7"><li>如果Sql After也没有发生错误，这个时候将会提交整个save的事务；</li> <li>接下来将运行标志了CheckType =SAVE，CheckRange =AFTER或者CheckRange =BOTH的方法，这些方法如果发生错误，返回错误信息也不会回滚之前的事务了，所以这时候尽量不要返回错误信息，只做一些确保正确的操作即可；</li></ol> <blockquote><p>请参考下图进一步了解</p></blockquote> <p><img src="/assets/img/tran_save.3b153604.jpg" alt="mssst"></p> <p><strong>删除的过程</strong></p> <p>删除的过程与保存的过程基本一样，只是deleteing的checker方法，在删除数据库的Entity操作之前运行；</p> <p><strong>创建的过程</strong></p> <p>创建的过程相比保存的过程，没有sql Before，没有 Saving，没有 sql After ；</p> <p><strong>读取的过程</strong></p> <p>读取的过程相比保存的过程，没有sql Before，没有 Saving，没有 sql After ；</p> <p><strong>模块的SEARCH</strong></p> <p>配置对应的<a href="#stSearch.xml">stSearch.xml</a>, 模块的名称与stSearch的名称需要相同</p> <h3 id="操作非模块数据"><a href="#操作非模块数据" class="header-anchor">#</a> 操作非模块数据</h3> <p>M18对于模块外的数据提供了<code>SqlTableCurdEAO</code>进行读写操作。<strong>注</strong>:如果对应的table是module中的数据，请审慎使用这种方法。</p> <ul><li>读取数据</li></ul> <p>使用SqlTableCurdEAO的read(StReadParam param)方法读取数据库table的数据；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token keyword">protected</span> <span class="token class-name">SqlTableCurdEAO</span> curdEAO<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">StReadParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StReadParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  param<span class="token punctuation">.</span><span class="token function">setTableName</span><span class="token punctuation">(</span><span class="token string">&quot;draft&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
  param<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token class-name">SqlTable</span> data <span class="token operator">=</span> curdEAO<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>创建空表结构&amp;保存数据</li></ul> <p>使用SqlTableCurdEAO的genEmptyTable(String tableName)可以获取一个有表结构的空的sqlTable；</p> <p>使用SqlTableCurdEAO的save(StUpdateParam param)可以保存table的数据；</p> <p>StUpdateParam 参数一定需要传入tableName,和SqlTable的数据</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token keyword">protected</span> <span class="token class-name">SqlTableCurdEAO</span> curdEAO<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">DraftDto</span> draft<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">SqlTable</span> sqlTable <span class="token operator">=</span> emptyTable<span class="token punctuation">.</span><span class="token function">genEmptyTable</span><span class="token punctuation">(</span><span class="token string">&quot;draft&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sqlTable<span class="token punctuation">.</span><span class="token function">addRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  sqlTable<span class="token punctuation">.</span><span class="token function">setBoolean</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;autoSave&quot;</span><span class="token punctuation">,</span> draft<span class="token punctuation">.</span><span class="token function">isAutoSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sqlTable<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;draftCode&quot;</span><span class="token punctuation">,</span> draft<span class="token punctuation">.</span><span class="token function">getDraftCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sqlTable<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;lastModifyDate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token comment">//do some coding</span>

  <span class="token class-name">StUpdateParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StUpdateParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  param<span class="token punctuation">.</span><span class="token function">setTableName</span><span class="token punctuation">(</span><span class="token string">&quot;draft&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  param<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>sqlTable<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> insertId  <span class="token operator">=</span> curdEAO<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> insertId<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CawLog</span><span class="token punctuation">.</span><span class="token function">logException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  reutrn <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>删除数据</li></ul> <p>使用SqlTableCurdEAO的delete(StDeleteParamparam)方法删除数据库table的数据；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span>
<span class="token keyword">protected</span> <span class="token class-name">SqlTableCurdEAO</span> curdEAO<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">StDeleteParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StDeleteParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  param<span class="token punctuation">.</span><span class="token function">setTableName</span><span class="token punctuation">(</span><span class="token string">&quot;draft&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
  param<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    curdEAO<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CawLog</span><span class="token punctuation">.</span><span class="token function">logException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="系统表描述"><a href="#系统表描述" class="header-anchor">#</a> 系统表描述</h2> <p>按照前面<a href="#%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9D%97">逻辑模块</a>中的描述，M18使用系统表来描述系统的一些通用功能以及控制。不单单逻辑模块，系统中的很多功能和约定都是通过系统的方式来进行控制和处理的。</p> <blockquote><p>xml默认存放在share项目下面。 路径大致为: /main/resources/META-INF/*.xml</p></blockquote> <h3 id="系统表关键字规范"><a href="#系统表关键字规范" class="header-anchor">#</a> 系统表关键字规范</h3> <p>由于大部分的系统表使用xml格式进行编写，请注意xml格式的一些要求和限制。
虽然xml并不是在服务器中间价运行的具体代码，不过由于配置将影响系统的大部分关键过程，请谨慎的修改。
M18推荐尽量使用小写字母进行编号的标识。并要求不要使用任何特殊符号。
对于table module等编号，推荐使用App的名字作为前缀。
在命名常用名字的时候，需要考虑是否会和其他App的名字产生冲突，并考虑合适的命名规则。</p> <h3 id="datadict-xml"><a href="#datadict-xml" class="header-anchor">#</a> datadict.xml</h3> <p>dataidct用于描述mysql数据库中的table view 以及对应的column信息。
同时，他会定义table的约束信息。（Index, Foreign Key, Unique Key等）
由于datadict的信息会直接生成数据库表信息，请记得避免使用数据库的关键字以及任何容易出现问题的命名方式。</p> <p><strong>注</strong>:系统在启动的时候，仅仅按照xml和数据库结构的差异进行数据库的更新。</p> <p><strong>注</strong>:关于<a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF%E7%9A%84%E5%90%8C%E6%AD%A5">View,Stored Procedure,Function的同步</a>将在本部分的后面介绍。</p> <blockquote><p>table的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>是</td> <td>字符</td> <td></td> <td>table的名字，在<code>M18</code>中仅仅运行使用小写字母。并不允许使用任何符号. table由于会生成到数据库中，创建的时候需要考虑全系统唯一</td></tr> <tr><td>sys</td> <td>否</td> <td>布尔</td> <td>false</td> <td>标记是否为系统表。 系统表不会检查<a href="#%E5%8D%95%E6%8D%AE%E6%9D%83%E9%99%90">数据权限</a>,不允许<a href="#%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA">导入导出</a>。</td></tr> <tr><td>mess</td> <td>是</td> <td>字符</td> <td></td> <td>table的MessCode</td></tr> <tr><td>pk</td> <td>否</td> <td>字符</td> <td>id</td> <td>用于标记当前table的主键栏位。在<code>M18</code>目前仅允许使用id栏位作为PK。<strong>注</strong>:未来将删除</td></tr> <tr><td>virtual</td> <td>否</td> <td>布尔</td> <td>false</td> <td>如果标记为true，表示当前记录的信息不需要影响数据库结构。一般View 或者一些虚拟的table需要使用。</td></tr> <tr><td>supportUdf</td> <td>否</td> <td>布尔</td> <td>true</td> <td>用于标记是否允许使用者添加自定义栏位</td></tr> <tr><td>templet</td> <td>否</td> <td>布尔</td> <td>false</td> <td>如果标记为true，不会影响数据库结构。注，该信息在内存无法找到，仅仅影响初始化过程。其他table可以使用Inherit的方式来继承本templet里面的信息。</td></tr> <tr><td>extend</td> <td>否</td> <td>布尔</td> <td>false</td> <td>如果为true，表示来用扩展已经存在的table</td></tr> <tr><td>onlyInMain</td> <td>否</td> <td>布尔</td> <td>false</td> <td>一般而来，我们一个table的xml信息描述会生成两个数据库的table(xxx + xxx_v),如果这个参数为true，则仅仅生成xxx。</td></tr></tbody></table> <blockquote><p>关于Inherit的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>字符</td> <td>用于描述需要继承的table templet的名字，只有table描述中templet为true的才可以使用。</td></tr></tbody></table> <p><strong>注</strong>: 如果在继承后需要修改某些栏位的属性，在Column中直接添加对应的描述即可。不过一般情况下 并不推荐这样处理。因为容易导致误解。</p> <blockquote><p>Column的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>是</td> <td>字符</td> <td></td> <td>栏位名字，表内唯一，推荐使用驼峰方式命名，不允许重名(忽略大小写下面的重名)。 <span style="color:red;font-weight:bold;"> 不允许使用任何特殊符，例如 &quot;*&quot;, &quot;_&quot;, &quot;-&quot;。</span></td></tr> <tr><td>type</td> <td>是</td> <td>字符</td> <td></td> <td>用了标记栏位属性</td></tr> <tr><td>mess</td> <td>是</td> <td>字符</td> <td></td> <td>column的MessCode</td></tr> <tr><td>length</td> <td>否</td> <td>整数</td> <td></td> <td>用于标记数据长度，在类型为char/number的情况下应该填写</td></tr> <tr><td>decimal</td> <td>否</td> <td>整数</td> <td></td> <td>用于标记number类型栏位的小数位，仅仅number的时候进行填写</td></tr> <tr><td>defValue</td> <td>否</td> <td>字符</td> <td></td> <td>用于标记栏位对应的默认值</td></tr> <tr><td>defPattern</td> <td>否</td> <td>字符</td> <td></td> <td>用于标记栏位对应的<a href="#pattern.xml">Pattern</a></td></tr> <tr><td>required</td> <td>否</td> <td>布尔</td> <td>false</td> <td>标记当前栏位是否必填，在save的时候 M18会根据这个进行检查</td></tr> <tr><td>identity</td> <td>否</td> <td>布尔</td> <td>false</td> <td>标记是否自增，一般仅仅用于id栏位</td></tr> <tr><td>i18nField</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标记当前栏位是否支持多语言设定。仅仅char栏位可以使用本属性</td></tr> <tr><td>i18nSrc</td> <td>否</td> <td>字符</td> <td></td> <td>在i18nField为true的时候才能使用。用于标记当前栏位跟进其他栏位自动开启i18nField。格式(Table.Column)</td></tr> <tr><td>allowNull</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标记对应的栏位在数据库中是否允许使用null. <strong>注</strong>:在数据库中有些类型的栏位有null的要求。</td></tr> <tr><td>buildIn</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标记是否系统栏位，在一些功能(例如 Search的可选字段)里面会将系统栏位使用文件夹和其他栏位分割出来。</td></tr> <tr><td>dataImport</td> <td>否</td> <td>布尔</td> <td>true</td> <td>用于标记当前栏位是否支持导入</td></tr> <tr><td>dataExport</td> <td>否</td> <td>布尔</td> <td>true</td> <td>用于标记当前栏位是否支持导出</td></tr> <tr><td>skipLookup</td> <td>否</td> <td>布尔</td> <td>false</td> <td>如果希望在search的时候该栏位不可见 将其标记为true</td></tr> <tr><td>skipAccess</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标记当前栏位在生成单据权限的Sql时候，是否需要参与考虑</td></tr> <tr><td>checkLookupVal</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标记对应的栏位在导入的时候，是否需要Search权限重新检查对应的栏位是否允许。</td></tr> <tr><td>genRuleDate</td> <td>否</td> <td>布尔</td> <td>true</td> <td>用于标记当前栏位是否可以作为CodeFormat生成过程中的日期栏位</td></tr> <tr><td>batchUpdate</td> <td>否</td> <td>布尔</td> <td>true</td> <td>用于标记当前栏位是否允许批量更新。<strong>注</strong>：有逻辑计算或无批量更新需要的栏位尽量不要进行标记。</td></tr> <tr><td>udfUpdate</td> <td>否</td> <td>布尔</td> <td></td> <td>用于标记对应的栏位是否支持自定义栏位更新</td></tr> <tr><td>skipFLR</td> <td>否</td> <td>布尔</td> <td>false</td> <td>如果为true，改栏位将不受字段级权限控制</td></tr> <tr><td>dataDupCheck</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标记对应的栏位是否支持数据重复检查。如果没有设置任何值，对应的栏位类型是字符串或者日期，或者pattern是lookup类型的，默认支持数据重复检查。</td></tr> <tr><td>dataEasy</td> <td>否</td> <td>布尔</td> <td>dataImport</td> <td>用于标志对应的栏位是否支持智能数据处理，如果没有设置任何值，默认使用dataImport的值</td></tr> <tr><td>lookupCurrentModule</td> <td>否</td> <td>布尔</td> <td>false</td> <td>用于标志对应的栏位是否lookup当前模块</td></tr></tbody></table> <blockquote><p>栏位属性说明</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>int_unsigned</td> <td>对应Java类型long <strong>注</strong>:所有的id字段目前都是用int_unsigned</td></tr> <tr><td>bigint</td> <td>对应Java类型long，非必要的情况下不要使用</td></tr> <tr><td>bit</td> <td>对应java类型boolean</td></tr> <tr><td>datetime</td> <td>对应日期时间栏位 java类型date</td></tr> <tr><td>date</td> <td>对应日期栏位 java类型date</td></tr> <tr><td>nvarchar/varchar</td> <td>对应java类型String, 这种类型需要指定需要使用的length</td></tr> <tr><td>text/longtext</td> <td>对应java类型String, <strong>注</strong>:text的可用长度有限，如果你确定需要足够的长度的栏位的时候请使用longtext</td></tr> <tr><td>numeric</td> <td>对应java类型double, 这种类型可以指定length+decimal</td></tr> <tr><td></td> <td><strong>注</strong>:文件类型栏位的说明请参考 <a href="#%E6%96%87%E4%BB%B6%E6%B5%81%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F">文件处理</a></td></tr></tbody></table> <blockquote><p>Index的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>字符</td> <td>Index的名称 一个table里面的index不允许重名</td></tr> <tr><td>columns</td> <td>字符</td> <td>用于标记当前index需要使用的栏位，多个栏位使用;分开</td></tr> <tr><td>unique</td> <td>布尔</td> <td>用于标记是否创建唯一键约束</td></tr></tbody></table> <blockquote><p>fk的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>字符</td> <td>Foreign Key的名字</td></tr> <tr><td>columns</td> <td>字符</td> <td>FK在当前table的栏位</td></tr> <tr><td>refTable</td> <td>字符</td> <td>FK指向的table的名字</td></tr> <tr><td>refColumns</td> <td>字符</td> <td>FK指向的栏位，允许空白，在空白的时候默认使用id栏位</td></tr></tbody></table> <p><strong>注</strong>:系统启动过程中将使用datadict的信息更新数据库的信息。特别的，对应栏位只增不删，如果有需要，请自己编写代码处理。</p> <p>如果你需要将一个栏位的属性修改，请另外新增一个栏位。因为数据修复过程可能存在无法预料的问题。然后在必要的时候，自己将不需要的栏位删除。</p> <p><strong>注</strong>:目前直接修改栏位属性虽然是允许操作的，不过系统将不会因此造成的问题做任何的提示或者修复。</p> <p>另外一个需要特别说明的就是将column的长度改小的时候，请注意数据库系统将可能会截断数据，而且将会无法修复。</p> <blockquote><p>示例:</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.multiable.com/datadict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- test info --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_base<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_base<span class="token punctuation">&quot;</span></span> <span class="token attr-name">templet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int_unsigned<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">identity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iRev<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.iRev<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defPattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iRev<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataImport</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>  <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createDate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>datetime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.createDate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NOW()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defPattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>datetime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataImport</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataExport</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">buildin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
  
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>inherit</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test_base<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>varchar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defPattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>column</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>varchar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defPattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">i18nField</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>index</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">columns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">unique</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="数据库信息的同步"><a href="#数据库信息的同步" class="header-anchor">#</a> 数据库信息的同步</h4> <p>系统启动的时候，除了会根据datadict.xml更新table信息，M18还支持开发者更新View,Stored Procedure,Function等。对于datadict信息，我们将这部门描述为other Information。</p> <p>具体做法如下:</p> <p>M18要求将文件存放在ejb项目的如下路径ejb/src/main/resources/sql/</p> <p>文件夹名字分别是view proc func</p> <p>每个独立的Object应该独立存储为一个文件。在对应的文件脚本里面一般均是删除已经存在的对象，然后在重新创建。</p> <blockquote><p>示例：一个Stored Procedure的脚本</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> test_dm<span class="token punctuation">;</span>

<span class="token keyword">DELIMITER</span> $$

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_dm<span class="token punctuation">(</span><span class="token operator">IN</span> dbname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token keyword">BEGIN</span>
    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test A <span class="token keyword">where</span> A<span class="token punctuation">.</span>db <span class="token operator">=</span> dbname<span class="token punctuation">;</span>
<span class="token keyword">END</span>$$

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div><p>更新的过程如下图</p> <p><img src="/assets/img/ddtodb.8848d99c.jpg" alt="mssst"></p> <h3 id="pattern-xml"><a href="#pattern-xml" class="header-anchor">#</a> pattern.xml</h3> <p>在M18中，系统使用pattern来对应一个栏位大致的表现方式。以及做一些常见的界面显示属性的规定。</p> <blockquote><p>record属性说明</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td>true</td> <td>string</td> <td></td> <td>pattern的名称</td></tr> <tr><td>type</td> <td>true</td> <td>string</td> <td></td> <td>pattern的类型；有七种可以选择填写：text；number；date；options；boolean；lookup；color</td></tr> <tr><td>info</td> <td>false</td> <td>string</td> <td></td> <td>pattern的一些info说明；</td></tr></tbody></table> <blockquote><p>text标签介绍，当record的type选择了text，那么下一级的标签要使用text标签；用于标志当前pattern定义的是一个文本类型；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>length</td> <td>true</td> <td>int</td> <td></td> <td>定义text的长度</td></tr> <tr><td>trim</td> <td>fasle</td> <td>boolean</td> <td>false</td> <td>当设置为true，会将栏位输入值前后的空格删掉</td></tr> <tr><td>upperCase</td> <td>false</td> <td>boolean</td> <td>false</td> <td>当设置为true，栏位输入的字母会变成大写</td></tr> <tr><td>mask</td> <td>false</td> <td>string</td> <td></td> <td>定义栏位输入一个固定格式</td></tr> <tr><td>regex</td> <td>false</td> <td>string</td> <td></td> <td>定义栏位的正则表达式</td></tr> <tr><td>html</td> <td>false</td> <td>boolean</td> <td>fasle</td> <td>如果设置为true，界面将会使用html组件显示栏位</td></tr></tbody></table> <blockquote><p>number标签介绍，当record的type选择了number，那么下一级的标签要使用number标签；用于标志当前pattern定义的是一个数字类型；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>length</td> <td>true</td> <td>int</td> <td></td> <td>定义number的总长度</td></tr> <tr><td>decimal</td> <td>fasle</td> <td>int</td> <td>0</td> <td>定义小数位的长度，默认为0；</td></tr> <tr><td>max</td> <td>false</td> <td>double</td> <td>false</td> <td>定义number的最大值</td></tr> <tr><td>min</td> <td>false</td> <td>double</td> <td></td> <td>定义number的最小值</td></tr> <tr><td>noSep</td> <td>false</td> <td>boolean</td> <td>fasle</td> <td>如果为true，数值将会有千分位 “,”</td></tr> <tr><td>negativeSymbol</td> <td>false</td> <td>boolean</td> <td>fasle</td> <td>如果为true，当数值为负数时，将会使用括号将数值包住</td></tr></tbody></table> <blockquote><p>lookup标签介绍，当record的type选择了lookup，那么下一级的标签要使用lookup标签；用于标志当前pattern定义的是一个查询数据类型；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>searchType</td> <td>true</td> <td>string</td> <td></td> <td>用于标记栏位对应的<a href="#stSearch.xml">stSearch</a></td></tr></tbody></table> <blockquote><p>options标签介绍，当record的type选择了options，那么下一级的标签要使用options标签；用于标志当前pattern定义的是一个下拉框选择类型；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>valueClass</td> <td>true</td> <td>string</td> <td>string</td> <td>用于定义option的数据类型；可选：String，Integer，Double，Combobox</td></tr> <tr><td>emptyValue</td> <td>false</td> <td>string</td> <td></td> <td>用于定义当没有选中任何option时应该是什么值</td></tr></tbody></table> <blockquote><p>options里面的子标签option介绍；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>value</td> <td>true</td> <td>string</td> <td></td> <td>选中后的值，真实保存的值</td></tr> <tr><td>label</td> <td>true</td> <td>string</td> <td></td> <td>显示在页面上看到的值，可以填messCode</td></tr></tbody></table> <blockquote><p>option里面的子标签icon介绍；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>false</td> <td>string</td> <td></td> <td>图标的名字</td></tr> <tr><td>library</td> <td>false</td> <td>string</td> <td></td> <td>图标库的系统路径</td></tr> <tr><td>url</td> <td>false</td> <td>string</td> <td></td> <td>图标的网络路径</td></tr> <tr><td>style</td> <td>false</td> <td>string</td> <td></td> <td>图标的css类型</td></tr> <tr><td>styleClass</td> <td>false</td> <td>string</td> <td></td> <td>图标的css类型class</td></tr></tbody></table> <p><strong>特殊pattern列表</strong></p> <p>请注意下面的均系统特殊的pattern，不推荐新增其他内容 而是直接使用</p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token comment">&lt;!-- this is for file.info the id of filedata --&gt;</span>
	//用于对应栏位存的是文件的fileId
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>12<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!-- this is for image, use code for safe! --&gt;</span>
	//用于对应栏位存的是图片的imgCode
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgCode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>60<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
	
	<span class="token comment">&lt;!-- date with time --&gt;</span>
	//用于显示日期加时间
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>datetime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
	
	//用于显示时间,格式为 HH:MM
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>time<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	//用于显示日期
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	//用于使用color组件
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>color<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>color<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	//用于表示栏位存的数据可以无限长度,注:仅可以存储2^32长度的信息，不够的情况下请使用longtext
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>charMax<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	//用于表示栏位存的是json格式的string
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>json<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	//用于表示栏位存的数据可以无限长度，datadict栏位对应的type一般为longtext
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>longtext<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>

	//用于表示使用html组件显示
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">length</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>record</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="navmenu-xml"><a href="#navmenu-xml" class="header-anchor">#</a> navmenu.xml</h3> <p>用户在使用M18系统的时候，需要通过菜单访问对应的模块。所以在M18授权的时候，也是通过菜单的方式进行控制的。系统里面使用navmenu.xml来定义系统的菜单。</p> <blockquote><p>menuType的描述，menuType用于定义菜单类型以及对应的图示。</p></blockquote> <table><thead><tr><th>名字</th> <th>子元素名字</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td></td> <td>用于表示一个菜单类型</td></tr> <tr><td>desc</td> <td></td> <td>menuType的MessCode</td></tr> <tr><td>icon</td> <td>name</td> <td>icon的名字 (icon用于菜单显示)</td></tr> <tr><td>icon</td> <td>library</td> <td>icon所在位置，系统CSS通过library和name来找到对应的图片</td></tr> <tr><td>image</td> <td>name</td> <td>image的名字 (image用于图像化菜单)</td></tr> <tr><td>image</td> <td>library</td> <td>image所在的位置</td></tr></tbody></table> <p>系统目前有</p> <ul><li><p>FM 用于表示<code>基础资料模块</code></p></li> <li><p>TRAN 用于表示<code>交易型模块</code></p></li> <li><p>SETTING 用于表示 <code>设定类型模块</code></p></li> <li><p>EBI 用于表示 <code>EBI模块</code></p></li> <li><p>OTHER/<code>留空</code> 用于表示 <code>其他类型模块</code></p> <p><img src="/assets/img/menuType.f3678c77.jpg" alt="mssst"></p></li></ul> <blockquote><p>示例:</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menuType</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FM<span class="token punctuation">&quot;</span></span> <span class="token attr-name">desc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fm/master<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cicon-fm-master-data<span class="token punctuation">&quot;</span></span> <span class="token attr-name">library</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font/cawIcon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fmIcon.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">library</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img/icon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menuType</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>function的属性描述, function在系统在表示一个菜单对应有的功能。 是授权的最小单元</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>是</td> <td>function的名字,推荐有字母以及下划线组成。</td></tr> <tr><td>group</td> <td>否</td> <td>分组用字段</td></tr> <tr><td>messCode</td> <td>是</td> <td>function的MessCode</td></tr> <tr><td>tooltip</td> <td>是</td> <td>function在授权模块显示的tooltip 用于用户快速了解对应的功能含义</td></tr></tbody></table> <p>现有功能的列表请在系统的授权模块进行查看。</p> <blockquote><p>menuHelper的属性描述，主要用于生成menuParam</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td>表示当前helper对于指定的菜单会生效。code需要添加menu的code</td></tr> <tr><td>mType</td> <td>表示当前helper对于特定类型的菜单都会生效</td></tr> <tr><td>class</td> <td>一个类的全名，需要实现MenuHelper。可以自定义isFor方法用于影响当前class影响的范围。</td></tr></tbody></table> <blockquote><p>folder的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td>folder的名字</td></tr> <tr><td>messCode</td> <td>folder的MessCode</td></tr> <tr><td>apDebug</td> <td>布尔值，如果是true的时候，仅仅在debug模式才会显示出来</td></tr> <tr><td>flag</td> <td>用于控制特定模块在功能不被完全购买的时候 不显示</td></tr> <tr><td>order</td> <td>用于定义folder在树中的顺序</td></tr></tbody></table> <blockquote><p>menu的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>子元素名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td></td> <td>字符</td> <td>menu的名字</td></tr> <tr><td>messCode</td> <td></td> <td>字符</td> <td>menu的MessCode</td></tr> <tr><td>src</td> <td></td> <td>字符</td> <td>menu对应的页面位置</td></tr> <tr><td>module</td> <td></td> <td>字符</td> <td>当前模块默认使用的module</td></tr> <tr><td>mType</td> <td></td> <td>字符</td> <td>菜单对应的menuType</td></tr> <tr><td>templet</td> <td></td> <td>布尔</td> <td>表当前模块为模块，其他模块运行继承(主要继承function)</td></tr> <tr><td>apDebug</td> <td></td> <td>布尔</td> <td>布尔值，如果是true的时候，仅仅在debug模式才会显示出来</td></tr> <tr><td>flag</td> <td></td> <td>字符</td> <td>用于控制特定模块在功能不被完全购买的时候 不显示</td></tr> <tr><td>inherit</td> <td>name</td> <td>字符</td> <td>填写templet为true的模块</td></tr> <tr><td>inherit</td> <td>include</td> <td>字符</td> <td>function的名字 并使用分号连接起来，用于继承指定功能</td></tr> <tr><td>inherit</td> <td>except</td> <td>字符</td> <td>function的名字 并使用分号连接起来，用于排除继承功能</td></tr> <tr><td>function</td> <td>name</td> <td>字符</td> <td>function的名字 并使用分号连接起来（用于表示当前模块有的功能，最高优先级）</td></tr> <tr><td>controller</td> <td><code>NA</code></td> <td>字符</td> <td>class名字 用于指定当前菜单需要使用的controller</td></tr> <tr><td>listener</td> <td><code>NA</code></td> <td>字符</td> <td>class名字 用于指定当前菜单需要使用的listener</td></tr> <tr><td>param</td> <td>key</td> <td>字符</td> <td>param的key param用于程序对于菜单进行添加额外参数使用</td></tr> <tr><td>param</td> <td>value</td> <td>字符</td> <td>param对应的value</td></tr> <tr><td>menuParam</td> <td>name</td> <td>字符</td> <td>参数名字,menuParam用于菜单连接使用，用于自定义连接的参数</td></tr> <tr><td>menuParam</td> <td>description</td> <td>字符</td> <td>参数在界面显示的MessCode</td></tr> <tr><td>menuParam</td> <td>pattern</td> <td>字符</td> <td>对应的参数类型</td></tr> <tr><td>menuParam</td> <td>folder</td> <td>字符</td> <td>参数分组</td></tr> <tr><td>order</td> <td></td> <td>整数</td> <td>用于定义menu在folder中的顺序</td></tr></tbody></table> <blockquote><p>示例：</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nm</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.multiable.com/navmenu<span class="token punctuation">&quot;</span></span> <span class="token attr-name">app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>caw<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>New<span class="token punctuation">&quot;</span></span> <span class="token attr-name">group</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Editor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">messCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.saveNew<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tooltip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right.tt.new<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Save<span class="token punctuation">&quot;</span></span> <span class="token attr-name">group</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Editor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">messCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.save<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tooltip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right.tt.save<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>folder</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sys<span class="token punctuation">&quot;</span></span> <span class="token attr-name">messCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.sys<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>menu</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">messCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view/module/test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>New;Save<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>menu</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>folder</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nm</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在代码中如何判定user是否有某个权限？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">UserRightInfo</span> info <span class="token operator">=</span> <span class="token class-name">UserLib</span><span class="token punctuation">.</span><span class="token function">getRight</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FrameRight</span> right <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">getFrameRight</span><span class="token punctuation">(</span>menu<span class="token punctuation">,</span>beId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注</strong>: 3PD自己添加的功能需要通过right里面的otherRight来判断。</p> <h3 id="module-xml"><a href="#module-xml" class="header-anchor">#</a> module.xml</h3> <p>Module表示一个模块（or功能）相关的表的集合。在M18的设计中Module必须有一个主表，其他表必须和主表的PK发生一定意义上的关联关系。</p> <blockquote><p>module的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>字符</td> <td>模块的名字</td></tr> <tr><td>mess</td> <td>字符</td> <td>模块的MessCode</td></tr> <tr><td>extend</td> <td>布尔</td> <td>用于表示当前描述用于扩展原有的module的属性</td></tr> <tr><td>mainTable</td> <td>字符</td> <td>用于指定当面模块的主表<strong>注</strong> 对应的table需要在子元素的table中出现</td></tr> <tr><td>useBe</td> <td>布尔</td> <td>表示当前模块需要使用Be，一般来说为交易型模块</td></tr> <tr><td>fmshare</td> <td>字符</td> <td>当这个栏位不为空的时候，表示为基础资料模块。推荐填写为N，表示默认将基础资料模块设置为BE数据共享</td></tr> <tr><td>useAccess</td> <td>布尔</td> <td>表示当前模块是否支持Data Guard权限控制。</td></tr> <tr><td>useAttach</td> <td>布尔</td> <td>用于控制模块是否启用附件功能。</td></tr> <tr><td>useApv</td> <td>布尔</td> <td>是否允许启用批核功能。</td></tr> <tr><td>useChangenote</td> <td>布尔</td> <td>是否启用变更单功能。</td></tr> <tr><td>useCache</td> <td>布尔</td> <td>是否使用cache。默认为true，<strong>注</strong>:如果你的模块已经自行cache 或者使用频率很低 或者无法cache等的时候，请记得将cache设置为false。 为了确保cache正确被更新，请更新数据的时候 必须将iRev + 1</td></tr> <tr><td>useAutoGenCode</td> <td>布尔</td> <td>是否允许使用编码生成规则。需要对应的模块有New功能。</td></tr> <tr><td>genCode_Field</td> <td>字符</td> <td>编码生成规则的目标字段。默认为code栏位</td></tr> <tr><td>genCode_Date</td> <td>字符</td> <td>编码生成规则的默认日期栏位。默认为createDate栏位</td></tr> <tr><td>fieldDataGuard</td> <td>整数</td> <td>标记对应的模块是否启用字段级权限。-1表示不启用 1表示启用 0 表示对应的模块有新增数据功能的时候启用</td></tr> <tr><td>udfLogicSkip</td> <td>布尔</td> <td>禁用用户自定义赋值更新功能</td></tr> <tr><td>supportUdf</td> <td>布尔</td> <td>是否允许使用自定义栏位功能</td></tr> <tr><td>checkCodeExist</td> <td>布尔</td> <td>在界面输入编号的时候，是否主动进行编号存在的检查 并提示用户。</td></tr> <tr><td>dataSynch</td> <td>字符</td> <td>用于标记当前模块是否允许在Data Easy中使用。默认需要模块有New的功能。如果为enable会默认允许。<strong>注</strong>:原本计划修改为boolean,后来因为兼容性问题没有修改。</td></tr> <tr><td>dataImportConveter</td> <td>字符</td> <td>Class类名，用于导入功能的处理类 见<a href="#%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA">导入与导出</a></td></tr> <tr><td>excelGener</td> <td>字符</td> <td>Class类名，用于导出功能的处理类 见<a href="#%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA">导入与导出</a></td></tr> <tr><td>template</td> <td>布尔</td> <td>用于标记当前配置描述是否模板，模板用于<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97">自定义模块</a>功能</td></tr> <tr><td>tableOrders</td> <td>字符</td> <td>用于说明下面table的解析次序，使用分号进行分割。<strong>注</strong>:主表一定第一次序</td></tr> <tr><td>codeDupLevel</td> <td>字符</td> <td>用于标记code重复的基本。默认为全系统唯一。值为BE的时候 BE+Code在数据库中唯一。<strong>注</strong>:系统系统的时候会自动创建唯一键约束, 请确保修改前数值的唯一性，避免无法正确启动系统。</td></tr> <tr><td>skipExpired</td> <td>布尔</td> <td>用于标记当前模块不启用失效功能</td></tr> <tr><td>skipSysBC</td> <td>布尔</td> <td>用于定义当前模块不创建code的唯一性约束；</td></tr> <tr><td>importAllowUpdate</td> <td>布尔</td> <td>用于定义当前模块在数据导入是否支持更新，默认为true；</td></tr> <tr><td>importThreadMode</td> <td>布尔</td> <td>用于定义当前模块在数据导入是否支持多线程，默认为true；</td></tr></tbody></table> <blockquote><p>table的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>字符</td> <td>table的名字，对应datadict的信息</td></tr> <tr><td>tpl</td> <td>字符</td> <td>用于<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97">自定义模块</a>。用于标记对应table使用那个真实的datadict(可以指向真实的表)</td></tr> <tr><td>c</td> <td>布尔</td> <td>用于标记是否支持create. 如果不支持的时候，将在操作的时候忽略这个table</td></tr> <tr><td>r</td> <td>布尔</td> <td>用于标记是否支持read. 如果不支持的时候，将在操作的时候忽略这个table</td></tr> <tr><td>u</td> <td>布尔</td> <td>用于标记是否支持save. 如果不支持的时候，将在操作的时候忽略这个table</td></tr> <tr><td>d</td> <td>布尔</td> <td>用于标记是否支持delete. 如果不支持的时候，将在操作的时候忽略这个table</td></tr> <tr><td>initRow</td> <td>整数</td> <td>用于标记在新增的时候，模块对应table需要初始化的行数。一般需要的情况下 应该仅仅设置为1</td></tr> <tr><td>forceInit</td> <td>布尔</td> <td>用于标记模块在被read出来的时候，如果对应的table的行数不足initRow中填写的数量的时候 是否强制补齐对应的记录数。<strong>注</strong>:通常仅仅用于后续补充表的时候 可能需要使用</td></tr> <tr><td>hpk</td> <td>字符</td> <td>用于标记当前table与主表关联的栏位。<strong>注</strong>:主表不需要填写 。 同一个模块的关联关系不要创建外键</td></tr> <tr><td>fkey</td> <td>字符</td> <td>用于标记footer表中唯一性栏位</td></tr> <tr><td>hfname</td> <td>字符</td> <td>用于标记第二层footer的信息。用于定位其上一层footer</td></tr> <tr><td>hfkey</td> <td>字符</td> <td>上一层footer的唯一性栏位</td></tr> <tr><td>order</td> <td>字符</td> <td>指定一个栏位用于控制table的读取排序次序。仅仅影响read的时候处理，不影响其他任何操作</td></tr> <tr><td>cpnType</td> <td>字符</td> <td>用于标记对应的table和主表的关系是1:N,请慎重标记。<strong>注</strong>:标记为table的时候 支持自定义栏位功能。</td></tr> <tr><td>discriminatorColumn</td> <td>字符</td> <td>标记一个分区栏位，用于处理table同时给多个模块使用的情况，在save的时候会自动设置为当前的module的名字</td></tr> <tr><td>resetDiscriminatorColumn</td> <td>布尔</td> <td>标记是否需要强制设置分区栏位。</td></tr> <tr><td>dataImport</td> <td>布尔</td> <td>标记是否支持导入功能 <strong>注</strong>:如果主表不支持的话，当前模块也不支持导入功能</td></tr> <tr><td>dataExport</td> <td>布尔</td> <td>标记是否支持导出功能 <strong>注</strong>:如果主表不支持的话，当前模块也不支持导出功能</td></tr> <tr><td>columnOrders</td> <td>字符</td> <td>栏位序列，使用分号进行连接，用于标记栏位处理次序</td></tr> <tr><td>fieldRightSetting</td> <td>布尔</td> <td>用于控制对应的table是否允许设置字段级权限</td></tr> <tr><td>compareKey</td> <td>字符</td> <td>栏位序列，使用分号进行连接，数据差异比较的时候 使用这个key进行两行数据的判定。默认使用id栏位</td></tr> <tr><td>sfKey</td> <td>字符</td> <td>当前footer表中与上一层footer关联的栏位</td></tr></tbody></table> <blockquote><p>checker的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>class</td> <td>字符</td> <td>class类名，用于标记对应的checker的名字</td></tr> <tr><td>exclude</td> <td>字符</td> <td>使用分号连接的方法名字。对应的名字将不会被当前checker运行</td></tr> <tr><td>include</td> <td>字符</td> <td>都是分号连接的方法名字。仅仅已经书写的名字才会被checker运行</td></tr> <tr><td>skipSuper</td> <td>布尔</td> <td>标记checker忽略class的上层class中的方法</td></tr> <tr><td>apployTo</td> <td>字符</td> <td>表示当前checker应用的范围。默认当前模块，你可以apply到指定模块，或者使用*表示所有的模块</td></tr></tbody></table> <blockquote><p>param的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>key</td> <td>param的key param用于程序对于模块进行添加额外参数使用</td></tr> <tr><td>value</td> <td>param对应的value</td></tr></tbody></table> <blockquote><p>dataImportExtend的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>extendSrc</td> <td>用于标记在数据导入模块使用的拓展页面</td></tr> <tr><td>dtoClass</td> <td>用于拓展页面的数据类</td></tr></tbody></table> <blockquote><p>dataExportExtend的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>extendSrc</td> <td>用于标记在数据导出模块使用的拓展页面</td></tr> <tr><td>dtoClass</td> <td>用于拓展页面的数据类</td></tr></tbody></table> <blockquote><p>示例:</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>md</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.multiable.com/module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>caw<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mainTable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useAccess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useAttach</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initRow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>useroption<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initRow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">forceInit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userrole<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hpk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cpnType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>usercontrol<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initRow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hpk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">forceInit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userdefbe<span class="token punctuation">&quot;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">initRow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hpk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>priority<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cpnType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        
        <span class="token comment">&lt;!-- this checker is for all module!  --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checker</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.ejb.checker.ModuleChecker<span class="token punctuation">&quot;</span></span> <span class="token attr-name">applyTo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checker</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.ejb.checker.ExtDataChecker<span class="token punctuation">&quot;</span></span> <span class="token attr-name">applyTo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
		
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>checker</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.ejb.checker.UserChecker<span class="token punctuation">&quot;</span></span>  <span class="token punctuation">/&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>md</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="i18n的实现"><a href="#i18n的实现" class="header-anchor">#</a> i18n的实现</h3> <p>M18系统支持在多种语言显示，系统要求至少实现英语, 简体中文, 繁体中文等。用户可以在系统内添加自定义语言。</p> <blockquote><p>对应的配置文件放在/main/resources/META-INF/lang/Message_*.properties</p></blockquote> <p>开发者使用Eclipse可以直接编辑对应的语言文件。</p> <p><img src="/assets/img/messcode.c5c72af9.jpg" alt="mssst"></p> <p><strong>注</strong>:在每添加一个新的MessCode的情况下, 英文是一定需要添加的。</p> <p>为了确保你添加的MessCode不和其他开发者冲突，M18推荐MessCode使用app名字作为前缀。</p> <p>在代码中你可以通过MessCode获取到你需要的文本信息。例如</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token class-name">CawGlobal</span><span class="token punctuation">.</span><span class="token function">getMess</span><span class="token punctuation">(</span><span class="token string">&quot;EBI&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>特别的，如果你的MessCode需要在JavaScript中使用，请在<code>webKey.properties</code>中间中添加记录。然后在JS中就可以进行调用了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> mText <span class="token operator">=</span> myView<span class="token punctuation">.</span><span class="token function">getMess</span><span class="token punctuation">(</span><span class="token string">'EBI'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注</strong>:在JavaScript使用的Mess应该避免web的一些关键字。</p> <blockquote><p>webKey.properties 示例</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code># web mess for core
CloseAllTabs
EBI
all
</code></pre></div><blockquote><p>用户添加多语言以及MessCode，请查看系统中的模块。 <code>新增语言</code> <code>描述编号</code></p></blockquote> <p>M18系统还支持数据层面的多语言。在<code>datadict</code>中将栏位设置<code>i18nField</code>为true。又因为系统运行用户在<code>新增语言</code> 进行语言添加，所以系统这部分信息使用一个Json栏位来存储对应的数据。</p> <p><strong>注</strong>:该字段系统根据当前table是否存在<code>i18nField</code>自动生成.</p> <blockquote><p><img src="/assets/img/i18nfield.26799b57.jpg" alt="mssst"><img src="/assets/img/i18n.920c277f.jpg" alt="mssst"></p></blockquote> <p>特别的，在SqlEntity中，对应的栏位会被还原为SqlTable的简单栏位。</p> <p>你可以如下操作对应的栏位</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> desc<span class="token operator">=</span> employee<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;desc_en&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
employee<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;desc_zh_CN&quot;</span><span class="token punctuation">,</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
employee<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;desc_en&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注</strong>:进行使用<a href="#%E6%A8%A1%E5%9D%97%E7%9A%84CURD">模块读写</a>可以这样操作，如果你直接更新数据库，对应的栏位并不存在，需更新Json栏位<code>i18nField</code></p> <h3 id="search的实现"><a href="#search的实现" class="header-anchor">#</a> Search的实现</h3> <p>search是M18系统常见的数据查询，通过配置stInfo.xml和stSearch.xml，可以查询出对应table/view等的数据；</p> <p>页面Lookup组件的数据查询也是使用了search去实现的。</p> <p><strong>注</strong>: 系统一些通用功能判定通用也是用过Search功能实现。</p> <h3 id="stinfo-xml"><a href="#stinfo-xml" class="header-anchor">#</a> stInfo.xml</h3> <p>stInfo是在定义search的table数据，为了避免table直接暴露给用户的一个折中方法。如果在stsearch中使用了一个stInfo，而对应的信息在stInfo.xml没有定义，系统会默认根据datadict生成对应的stInfo信息。</p> <blockquote><p>stInfo标签的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>true</td> <td>string</td> <td>stInfo 的名字，一般与所对应的table同名</td></tr> <tr><td>mess</td> <td>true</td> <td>string</td> <td>stInfo的mess</td></tr> <tr><td>table</td> <td>true</td> <td>string</td> <td>对应datadict table的名字；</td></tr> <tr><td>inCols</td> <td>false</td> <td>string</td> <td>这个参数的作用是：定义table中哪些栏位在这个stInfo是可用的。如果这个参数为空，代表对应table的所有栏位在这个stInfo都时可用的。不为空，则两个栏位之间需要用使用分号 “;” 隔开</td></tr> <tr><td>exCols</td> <td>false</td> <td>string</td> <td>这个参数的作用是：定义table中哪些栏位在当前stInfo是不可用的。如果这个参数为空，代表对应table的所有栏位在这个stInfo都时可用的。不为空，则两个栏位之间需要用使用分号 “;” 隔开</td></tr> <tr><td>autoRelation</td> <td>false</td> <td>boolean</td> <td>用于标记lookup栏位自动创建relation</td></tr> <tr><td>skipBuildin</td> <td>false</td> <td>boolean</td> <td>用于标记build-in栏位可以在lookup条件中使用</td></tr></tbody></table> <blockquote><p>relation标签的属性描述：relation标签是定义当前stInfo的table如何与另一个stInfo的table进行关联；关联后用于search的查询；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>col</td> <td>false</td> <td>string</td> <td>必须是stInfo对应table里面的栏位，本stInfo的table将会和tarSt对应的table通过col和tarCol关联</td></tr> <tr><td>tarSt</td> <td>true</td> <td>string</td> <td>需要关联到的stInfo名称</td></tr> <tr><td>tarCol</td> <td>false</td> <td>string</td> <td>必须需要关联到的stInfo对应table里面的栏位</td></tr> <tr><td>tarNullAble</td> <td>false</td> <td>boolean</td> <td>默认为false；如果为true；则关联时使用left outer join；否则使用inner join</td></tr> <tr><td>joinCond</td> <td>false</td> <td>string</td> <td>如果值不为空，则使用这个设置的条件进行关联；否则使用col 和tarCol进行关联；</td></tr></tbody></table> <blockquote><p>col标签的属性描述：col标签用于定义自定义栏位用在search的结果返回；这个标签不是必须的</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>true</td> <td>string</td> <td></td> <td>栏位的名称</td></tr> <tr><td>mess</td> <td>true</td> <td>string</td> <td></td> <td>栏位的messCode</td></tr> <tr><td>pattern</td> <td>false</td> <td>string</td> <td></td> <td>用于标记栏位对应的<a href="#pattern.xml">Pattern</a></td></tr> <tr><td>sql</td> <td>false</td> <td>string</td> <td></td> <td>如果这个栏位的值是要从数据库查询出来的，就需要设置一段sql给到这个</td></tr> <tr><td>cond</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果值为true，这个栏位可以作为查询条件使用</td></tr> <tr><td>sort</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果值为true，这个栏位可以用于排序</td></tr> <tr><td>show</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果值为true，这个栏位可以显示到页面上</td></tr></tbody></table> <blockquote><p>handler 标签的属性秒： handler标签用于配置stInfo的handler类用于初始化stInfo；这个标签不是必须的</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>stInfoName</td> <td>true</td> <td>string</td> <td>stInfo的名称</td></tr> <tr><td>className</td> <td>true</td> <td>string</td> <td>handler的class路径</td></tr></tbody></table> <h3 id="stsearch-xml"><a href="#stsearch-xml" class="header-anchor">#</a> stSearch.xml</h3> <blockquote><p>stSearch标签的参数属性</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>true</td> <td>string</td> <td></td> <td>stSearch 的名字</td></tr> <tr><td>mess</td> <td>true</td> <td>string</td> <td></td> <td>stSearch的messCode</td></tr> <tr><td>srcSt</td> <td>false</td> <td>string</td> <td></td> <td>使用stInfo.xml里面配置的stInfo</td></tr> <tr><td>maxLevel</td> <td>false</td> <td>int</td> <td>3</td> <td>用于表示stInfo向下最多可以relation多少层</td></tr> <tr><td>defCond</td> <td>false</td> <td>string</td> <td></td> <td>默认查询条件</td></tr> <tr><td>sort</td> <td>false</td> <td>string</td> <td></td> <td>默认排序方式</td></tr> <tr><td>supportMultiSort</td> <td>false</td> <td>boolean</td> <td>false</td> <td>如果设置为false，只能使用一个栏位排序</td></tr> <tr><td>asyncGetCount</td> <td>false</td> <td>boolean</td> <td>false（如果没有设置ejb或者没有设置slave，默认值为true）</td> <td>如果设置为true，lookup查询总数的将会和查询数据分开查询</td></tr> <tr><td>mustJoinSt</td> <td>false</td> <td>string</td> <td></td> <td>用于定义这个查询中必须要join的stInfo，stInfo必须在srcSt的relation层级关系里；两个或多个stInfo需要用分号“‘;”隔开；</td></tr> <tr><td>ejb</td> <td>false</td> <td>string</td> <td></td> <td>拼Search sql 的ejb，必须要继承GenSearchSqlAdapter；如果栏位没有设置，使用系统默认的ejb；</td></tr> <tr><td>udfUse</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果设置为false，不会出现在自定义查询模块</td></tr> <tr><td>accessModule</td> <td>false</td> <td>string</td> <td></td> <td>用于指定当前stSearch查询数据对应的模块</td></tr> <tr><td>accessField</td> <td>false</td> <td>string</td> <td>“id”</td> <td>用于拼access Sql 时，指定srcSt通过哪个栏位和footer table 的id栏位关联</td></tr> <tr><td>nameCardSupport</td> <td>false</td> <td>boolean</td> <td>true</td> <td>用于设置是否支持nameCard</td></tr> <tr><td>hideFormat</td> <td>false</td> <td>boolean</td> <td>false</td> <td>如果设置为true；lookup将会隐藏format，用户不能设置</td></tr> <tr><td>hideFilter</td> <td>false</td> <td>boolean</td> <td>false</td> <td>如果设置为false，用户无法在Lookup页面添加filter条件</td></tr> <tr><td>supportSearch</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果设置为false，用户无法在lookup页面使用模糊查询功能</td></tr> <tr><td>supportDeletedData</td> <td>false</td> <td>boolean</td> <td>false</td> <td>如果为true，search可以查询已被删除的记录</td></tr> <tr><td>slaveEjb</td> <td>false</td> <td>string</td> <td></td> <td>slave的class路径</td></tr> <tr><td>slaveApplyTo</td> <td>false</td> <td>string</td> <td></td> <td>当前的slave可以使用在其他的stSearch上；这里填写stSearch name；如果需要填写两个以上的stSearch，请使用分号“；”隔开；</td></tr> <tr><td>skipAccess</td> <td>false</td> <td>boolean</td> <td>false</td> <td>如果设置为true，lookup将跳过Access检查</td></tr></tbody></table> <blockquote><p>slaveCol标签的属性描述：slaveCol标签用于定义自定义栏位用在search的结果返回；这个标签不是必须的</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>col</td> <td>true</td> <td>string</td> <td></td> <td>栏位的名称</td></tr> <tr><td>mess</td> <td>true</td> <td>string</td> <td></td> <td>栏位的messCode</td></tr> <tr><td>pattern</td> <td>false</td> <td>string</td> <td></td> <td>用于标记栏位对应的<a href="#pattern.xml">Pattern</a></td></tr> <tr><td>sql</td> <td>false</td> <td>string</td> <td></td> <td>如果这个栏位的值是要从数据库查询出来的，就需要设置一段sql给到这个</td></tr> <tr><td>cond</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果值为true，这个栏位可以作为查询条件使用</td></tr> <tr><td>sort</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果值为true，这个栏位可以用于排序</td></tr> <tr><td>show</td> <td>false</td> <td>boolean</td> <td>true</td> <td>如果值为true，这个栏位可以显示到页面上</td></tr> <tr><td>followField</td> <td>false</td> <td>string</td> <td></td> <td>填一个当前stInfo下或者关联table下的field；用于将当前加的slaveField跟在这个field后面在format设置界面的左边栏显示；</td></tr></tbody></table> <blockquote><p>bindCond 标签的参数介绍；bingCond是stSearch默认加的一个条件；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>andOr</td> <td>false</td> <td>string</td> <td></td> <td>如果没有设置，会使用“and”去拼sql</td></tr> <tr><td>leftBrackets</td> <td>false</td> <td>string</td> <td></td> <td>如果需要填值，一般会填&quot;(&quot;</td></tr> <tr><td>leftFieldMode</td> <td>false</td> <td>string</td> <td>&quot;column&quot;</td> <td>表示leftField的类型</td></tr> <tr><td>leftField</td> <td>false</td> <td>string</td> <td></td> <td>如果leftFieldMode 是“column”；那么这里就要填栏位名称；如果leftFieldMode是“value”，那么这里就填数据</td></tr> <tr><td>operator</td> <td>fasle</td> <td>string</td> <td>&quot;=&quot;</td> <td>这里填操作符号；默认为等于号</td></tr> <tr><td>rightFieldMode</td> <td>false</td> <td>string</td> <td>&quot;value&quot;</td> <td>表示rightField的类型</td></tr> <tr><td>rightField</td> <td>fasle</td> <td>string</td> <td></td> <td>如果leftFieldMode 是“column”；那么这里就要填栏位名称；如果leftFieldMode是“value”，那么这里就填数据</td></tr> <tr><td>rightBrackets</td> <td>false</td> <td>string</td> <td></td> <td>如果需要填值，一般会填&quot;)&quot;</td></tr> <tr><td>condString</td> <td>false</td> <td>string</td> <td></td> <td>这里填一段sql的查询条件；如果这里设置了sql条件，上面的那些参数配置将会失效；</td></tr></tbody></table> <blockquote><p>format标签的参数介绍; format用于配置查询的系统format</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>id</td> <td>true</td> <td>int</td> <td>-1</td> <td>不能大于0；如果大于0将改为-</td></tr> <tr><td>mess</td> <td>true</td> <td>string</td> <td></td> <td>format的messCode</td></tr></tbody></table> <blockquote><p>formt里面的cond 标签的参数介绍；用于设置format的默认条件；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>andOr</td> <td>false</td> <td>string</td> <td></td> <td>如果没有设置，会使用“and”去拼sql</td></tr> <tr><td>leftBrackets</td> <td>false</td> <td>string</td> <td></td> <td>如果需要填值，一般会填&quot;(&quot;</td></tr> <tr><td>leftFieldMode</td> <td>false</td> <td>string</td> <td>&quot;column&quot;</td> <td>表示leftField的类型</td></tr> <tr><td>leftField</td> <td>false</td> <td>string</td> <td></td> <td>如果leftFieldMode 是“column”；那么这里就要填栏位名称；如果leftFieldMode是“value”，那么这里就填数据</td></tr> <tr><td>operator</td> <td>fasle</td> <td>string</td> <td>&quot;=&quot;</td> <td>这里填操作符号；默认为等于号</td></tr> <tr><td>rightFieldMode</td> <td>false</td> <td>string</td> <td>&quot;value&quot;</td> <td>表示rightField的类型</td></tr> <tr><td>rightField</td> <td>fasle</td> <td>string</td> <td></td> <td>如果leftFieldMode 是“column”；那么这里就要填栏位名称；如果leftFieldMode是“value”，那么这里就填数据</td></tr> <tr><td>rightBrackets</td> <td>false</td> <td>string</td> <td></td> <td>如果需要填值，一般会填&quot;)&quot;</td></tr> <tr><td>condString</td> <td>false</td> <td>string</td> <td></td> <td>这里填一段sql的查询条件；如果这里设置了sql条件，上面的那些参数配置将会失效；</td></tr></tbody></table> <blockquote><p>format里面的col标签的参数介绍; 用于配置默认显示栏位；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>col</td> <td>true</td> <td>string</td> <td></td> <td>填栏位的名称</td></tr> <tr><td>mess</td> <td>false</td> <td>string</td> <td></td> <td>如果想改变栏位显示mess；可以这里填一个messCode覆盖</td></tr> <tr><td>width</td> <td>false</td> <td>string</td> <td></td> <td>栏位在lookup Table 默认显示多宽</td></tr> <tr><td>sortable</td> <td>false</td> <td>boolean</td> <td>true</td> <td>用于标记对应的栏位可以使用排序</td></tr></tbody></table> <blockquote><p>format中sort标签的介绍；sort标签用于配置默认的排序；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>col</td> <td>true</td> <td>string</td> <td></td> <td>填栏位的名称</td></tr> <tr><td>ascending</td> <td>false</td> <td>boolean</td> <td>false</td> <td>如果设置为true；将会使用由大到小排序</td></tr></tbody></table> <blockquote><p>namecard标签介绍：请查看资料名片(namecard)开发</p></blockquote> <blockquote><p>handler标签介绍；handler标签用于配置lookup参数StParameter的init方法；init方法在导入数据对lookup栏位进行search检查前运行，和页面lookup栏位在查询前运行</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>true</td> <td>string</td> <td></td> <td>填一个class的路径；class里面的方法必须要有@InitStSearchParam注释的</td></tr></tbody></table> <blockquote><p>stSearchInitHandler标签介绍；stSearchInitHandler标签用于配置初始化stSearch的class；</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认</th> <th>说明</th></tr></thead> <tbody><tr><td>stSearchName</td> <td>true</td> <td>string</td> <td></td> <td>填一个stSearch的名称</td></tr> <tr><td>className</td> <td>true</td> <td>string</td> <td></td> <td>填一个继承了StSearchInitHandlerAdapter的类的路径</td></tr></tbody></table> <p>**注：**通过配置stInfo和stSearch，就可以使用search查询；</p> <blockquote><p>配置xml ：stInfo</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stInfo</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>share.user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">table</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stInfo</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stInfo</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>share.employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">table</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relation</span> <span class="token attr-name">col</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>createUid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tarSt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tarCol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relation</span> <span class="token attr-name">col</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lastModifyUid<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tarSt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simpleUser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tarCol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stInfo</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>stSearch</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stSearch</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">srcSt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxLevel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#employee#.code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accessModule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">asyncGetCount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bindCond</span> <span class="token attr-name">leftField</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">operator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!=<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rightField</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span> <span class="token attr-name">mess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>core.defFormat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>col</span> <span class="token attr-name">col</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>col</span> <span class="token attr-name">col</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>namecard</span> <span class="token attr-name">imgCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>photoCode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>290<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>namecard</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stSearch</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="影响search过程"><a href="#影响search过程" class="header-anchor">#</a> 影响Search过程</h4> <p>**注:**在search过程中，开发者可以通过配置slave，handler去干预search；</p> <p>1 配置slave类；需要继承SearchSlaveAdapter；然后通过beforeDatalookup和afterDatalookup两个方法干预search过程；beforeDatalookup通过添加条件，可以影响查询结果；afterDatalookup可以直接对查询结果进行修改，并返回希望得到的结果；</p> <p>2 handler类：在stSearch.xml配置的handler标签；处理方法在导入数据对lookup栏位进行search检查前运行，和在页面lookup栏位查询前运行；</p> <p>通过例子代码可以看到；handler里面的处理方法需要添加注释@InitStSearchParam；然后方法必须是static的，并且参数也是固定的(StParameter param, SqlEntity entity, String tableName, String colName, int row) ；</p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>handler</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.share.modulestsearch.InitStParam<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>handler</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InitStParam</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@InitStSearchParam</span><span class="token punctuation">(</span>moduleName <span class="token operator">=</span> <span class="token string">&quot;dept&quot;</span><span class="token punctuation">,</span> stSearch <span class="token operator">=</span> <span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">initDeptSupDeptParam</span><span class="token punctuation">(</span><span class="token class-name">StParameter</span> param<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> entity<span class="token punctuation">,</span> <span class="token class-name">String</span> tableName<span class="token punctuation">,</span> <span class="token class-name">String</span> colName<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&quot;dept&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;supDept&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>colName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3 initHandler类：</p> <p>在stSearch.xml添加标签stSearchInitHandler；可以在让3PD对系统已有的stSearch进行额外的初始化处理；</p> <p>handler类需要继承StSearchInitHandlerAdapter；</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stSearchInitHandler</span> <span class="token attr-name">stSearchName</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.share.modulestsearch.EmpStSearchHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpStSearchHandler</span> <span class="token keyword">extends</span> <span class="token class-name">StSearchInitHandlerAdapter</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initStSearch</span><span class="token punctuation">(</span><span class="token class-name">StSearchInfo</span> stSearchInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">CawLog</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>stSearchInfo<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>在stInfo.xml添加标签handler；可以在让3PD对系统已有的stInfo进行额外的初始化处理；</p> <p>handler类需要继承StInfoHandlerAdapter；</p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>handler</span> <span class="token attr-name">stInfoName</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.share.modulestsearch.EmpStInfoHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpStInfoHandler</span> <span class="token keyword">extends</span> <span class="token class-name">StInfoHandlerAdapter</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initStInfo</span><span class="token punctuation">(</span><span class="token class-name">StInfo</span> stInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">CawLog</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>stInfo<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h4 id="自定义的search"><a href="#自定义的search" class="header-anchor">#</a> 自定义的Search</h4> <p>方案1：重定义<code>searchEJB</code></p> <p>**注:**如果系统默认拼接sql功能不能满足查询的需要，可以重定义SearchEJB；</p> <p>限制：ejb需要继承<code>GenSearchSqlAdapter</code>；</p> <p>示例：在stSearch标签的ejb写上对应EJB的名字；ejb =&quot;GenEmptySqlEJB&quot;；然后继承<code>GenSearchSqlAdapter</code>类即可；返回的<code>SearchSqlInfo</code>填好查询数据的sql：searchSql和查询总数的sql：countSql；</p> <blockquote><p>示例：</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Stateless</span>
<span class="token annotation punctuation">@Local</span><span class="token punctuation">(</span><span class="token class-name">GenSearchSql</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenEmptySqlEJB</span> <span class="token keyword">extends</span> <span class="token class-name">GenSearchSqlAdapter</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">SearchSqlInfo</span> <span class="token function">getLookupSql</span><span class="token punctuation">(</span><span class="token class-name">StSearchInfo</span> myInfo<span class="token punctuation">,</span> <span class="token class-name">StParameter</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SearchSqlInfo</span> emptyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSqlInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emptyData<span class="token punctuation">.</span><span class="token function">setSearchSql</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		emptyData<span class="token punctuation">.</span><span class="token function">setCountSql</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> emptyData<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>方案2：重定义searchEJB + slave</p> <p>**注:**如果一个stSearch的数据不需要从数据库查询出来，可以使用重定义SearchEJB + 使用slave生成数据；</p> <p>限制：ejb需要继承<code>GenSearchSqlAdapter</code>，slave需要继承<code>SearchSlaveAdapter</code></p> <p>示例：在stSearch标签的ejb写上对应EJB的名字；ejb =&quot;GenEmptySqlEJB&quot; slaveEjb=&quot;PatternInfoSlave&quot;；</p> <p>java代码</p> <p><code>GenEmptySqlEJB</code> 请参考上面的<code>GenEmptySqlEJB</code>例子</p> <p><code>PatternInfoSlave</code>：在slave生成数据，只需要<em>override</em> <code>afterDatalookup</code> 方法即可；</p> <blockquote><p>示例：</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Stateless</span>
<span class="token annotation punctuation">@Local</span><span class="token punctuation">(</span><span class="token class-name">SearchSlave</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PatternInfoSlave</span> <span class="token keyword">extends</span> <span class="token class-name">SearchSlaveAdapter</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterDatalookup</span><span class="token punctuation">(</span><span class="token class-name">SearchResult</span> result<span class="token punctuation">,</span> <span class="token class-name">StParameter</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SqlTable</span> sqlTable <span class="token operator">=</span> <span class="token class-name">StLookupLib</span><span class="token punctuation">.</span><span class="token function">createEmptyLookupTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sqlTable<span class="token punctuation">.</span><span class="token function">addField</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlTableField</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token comment">//do some search coding</span>

		<span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> startRow <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getStartRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> param<span class="token punctuation">.</span><span class="token function">getStartRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> endRow <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getEndRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> param<span class="token punctuation">.</span><span class="token function">getEndRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> startRow<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> endRow<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">CawPattern</span> pattern <span class="token operator">=</span> <span class="token class-name">CawGlobal</span><span class="token punctuation">.</span><span class="token function">getPattern</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> rec <span class="token operator">=</span> sqlTable<span class="token punctuation">.</span><span class="token function">addRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sqlTable<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token string">&quot;st_id&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
			sqlTable<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token string">&quot;st_code&quot;</span><span class="token punctuation">,</span> pattern<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sqlTable<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token string">&quot;st_desc&quot;</span><span class="token punctuation">,</span> pattern<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sqlTable<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
			sqlTable<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> pattern<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sqlTable<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>rec<span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> pattern<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			id<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		result<span class="token punctuation">.</span><span class="token function">setResultTable</span><span class="token punctuation">(</span>sqlTable<span class="token punctuation">)</span><span class="token punctuation">;</span>
		result<span class="token punctuation">.</span><span class="token function">setTotalRows</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>方案3：自己编写组件</p> <p>**注:**系统现有的lookup组件无法满足用户的需求，那么可以自行编写组件，不再使用stSearch/stInfo的配置了；</p> <p>限制：页面和查询的所有东西都需要自行处理；</p> <h2 id="权限控制"><a href="#权限控制" class="header-anchor">#</a> 权限控制</h2> <h3 id="影响登录"><a href="#影响登录" class="header-anchor">#</a> 影响登录</h3> <ul><li>loginHandler</li></ul> <p>用户登录的过程，除了密码可以做限制外；开发者可以通过app.xml配置loginHandler标签进行登录干预；使用loginHandler的checkLoginInfoBeforeLogin方法可以在用户登录前干预用户登录；使用afterLogin方法可以在用户登录后做一些特殊处理；</p> <blockquote><p>loginHandler标签参数介绍</p></blockquote> <table><thead><tr><th>名称</th> <th>说明</th></tr></thead> <tbody><tr><td>className</td> <td>class的完成路径，class需要继承LoginHandlerAdapter</td></tr></tbody></table> <ul><li>wsSkipAccess</li></ul> <p>M18系统对于一些web service的请求，一般都会检查web service是否有权限请求数据的；会判断请求里面的参数userKey或者Authorization是否有权限；使用app.xml配置wsSkipAccess标签使一些web service的请求跳过这些权限的检查</p> <blockquote><p>wsSkipAccess标签参数介绍</p></blockquote> <table><thead><tr><th>名称</th> <th>说明</th></tr></thead> <tbody><tr><td>pathNames</td> <td>如果请求的web service包含这里定义的路径，可以跳过检查；如果是多个路径，可以使用分号“;”隔开；例子：&quot;/cawLogin/checkLoginUser;/image/getImage“</td></tr></tbody></table> <ul><li>webSkipAccess</li></ul> <p>M18系统对于一些不是web service的请求也一样会检查session的登录状态；使用app.xml配置webSkipAccess标签会使一些请求跳过检查</p> <blockquote><p>webSkipAccess标签参数介绍</p></blockquote> <table><thead><tr><th>名称</th> <th>说明</th></tr></thead> <tbody><tr><td>pathNames</td> <td>如果请求路径包含这里定义的路径，可以跳过检查；如果是多个路径，可以使用分号“;”隔开；例子：&quot;/CaptchaServlet;/wfAction”</td></tr></tbody></table> <h3 id="模块权限"><a href="#模块权限" class="header-anchor">#</a> 模块权限</h3> <p>M18系统通过模块和菜单配置当前模块有什么权限，如何配置请查看<a href="#navmenu.xml">navmenu.xml</a>;</p> <h3 id="单据权限"><a href="#单据权限" class="header-anchor">#</a> 单据权限</h3> <p>模块如果启用了权限控制，在参看单据的时候会进行单据的权限查询；如何启用请看<a href="#module.xml">module.xml</a>;</p> <p>单据的权限查询sql放在模块对应的StSearchInfo.java 里面；</p> <blockquote><p>权限查询sql介绍</p></blockquote> <table><thead><tr><th>名称</th> <th>说明</th></tr></thead> <tbody><tr><td>accessStr_noBe</td> <td>如果模块没有使用Be，将会使用这个sql判断单据的权限</td></tr> <tr><td>accessStr_oneBe</td> <td>如果模块使用了Be；查单个Be里面的数据，使用这个sql查询</td></tr> <tr><td>accessStr_manyBe</td> <td>如果模块使用了Be；查多个Be里面的数据，使用这个sql查询</td></tr> <tr><td>accessStr_mir</td> <td>判断已删除单据的权限，使用这个sql查询</td></tr></tbody></table> <blockquote><p>权限sql生成的过程</p></blockquote> <p>每一次stSearch初始化的时候，都会运行StSearchInfo的initAccess方法初始化生成这些查询sql；这里会根据<strong>访问控制</strong>模块的设置，先拼当前模块的access表（白名单和黑名单表）的sql；然后模块里面所有表（系统表除外）的lookup field（如果要忽略，请在datadict标志为skipAccess=“true”）会判断是否要检查access权限，如果要就将sql拼起来；</p> <h4 id="如何影响权限数据"><a href="#如何影响权限数据" class="header-anchor">#</a> 如何影响权限数据</h4> <p><strong>访问控制</strong>模块有自动计算访问控制的功能；在模块单据保存后，会根据自动计算访问控制设置的条件计算出单据的权限数据，然后保存起来；</p> <p>**注：**然而，开发者可以通过entityHandler的autoCalcAccess方法干预这些自动计算访问控制的结果；</p> <blockquote><p>entityHandler的参数介绍</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>string</td> <td>填模块的名称，如果为空，则这个entityHandler作用于所有模块</td></tr> <tr><td>className</td> <td>string</td> <td>class的完整路径，class需要继承EntityHandlerAdapter</td></tr></tbody></table> <h4 id="如何替换search的权限"><a href="#如何替换search的权限" class="header-anchor">#</a> 如何替换Search的权限</h4> <p>开发者可以通过<a href="#%E5%BD%B1%E5%93%8DSearch%E8%BF%87%E7%A8%8B">影响Search过程</a> 的第3点initHandler类实现；</p> <p>在stSearch的InitHandler中修改权限查询sql；就可以替换Search的权限了；</p> <h3 id="字段权限"><a href="#字段权限" class="header-anchor">#</a> 字段权限</h3> <p>系统表不能使用字段权限，还有所有表的“code”，“desc”，“beId”；buildin栏位也不能设置字段权限；</p> <p>开发者可以通过<a href="#module.xml">module.xml</a>的table标签配置参数fieldRightSetting=‘false’，使模块的这个table下的所有字段不能使用字段权限控制；</p> <p>**注：**可以通过RightLib的以下方法获取字段权限；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FieldRightDto</span><span class="token punctuation">&gt;</span></span> <span class="token function">getFieldRight</span><span class="token punctuation">(</span><span class="token keyword">long</span> beId<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tables<span class="token punctuation">)</span>；
<span class="token comment">//获取当前用户的字段权限，Set&lt;String&gt; tables传入需要获取字段权限的table name </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FieldRightDto</span><span class="token punctuation">&gt;</span></span> <span class="token function">getFieldRight</span><span class="token punctuation">(</span><span class="token keyword">long</span> beId<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tables<span class="token punctuation">,</span> <span class="token keyword">long</span> uid<span class="token punctuation">)</span>；
<span class="token comment">//传入user id 获取对应用户的字段权限，Set&lt;String&gt; tables传入需要获取字段权限的table name </span>
</code></pre></div><h2 id="常用功能"><a href="#常用功能" class="header-anchor">#</a> 常用功能</h2> <h3 id="关于配置文件"><a href="#关于配置文件" class="header-anchor">#</a> 关于配置文件</h3> <ul><li>cawserver.properties</li></ul> <p>cawserver.properties放在jboss的config文件夹里面；用于配置当前服务器的初始化参数；M18系统启动后会读取这些配置，使用配置的参数工作；</p> <blockquote><p>cawserver.properties 参数介绍</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code>#jboss server的识别码 在集群环境下，必须要设置为不一样
caw.jboss.id=cl

#jboss server属于哪一个群，为空时不会执行一些集群的事件
caw.jboss.cluster=abc

#有部分工作在服务器启动的时候需要运行，仅仅main.server为true的会执行。
#在集群环境 请确保只有一部server为true
caw.main.server=true


#注意:所有的路径不要使用\\结尾,由AP在代码自己处理
#两个path必须要指向用一个文件夹。dbDoc表示db服务器可以访问的路径。appDoc表示Jboss可以访问的路径。（对应路径用于文件传输，请确保访问速度OK）
#当两个服务器在一起的时候 请不要使用网络路径。注意 请一定要使用\\来作为路径分隔符
#share path in window(192.168.10.118)
caw.fileData.dbDoc.path=D:\\CAWShareAP
caw.fileData.appDoc.path=\\\\192.168.10.118\\CAWShareAP

#这个指向一个jboss的临时路径，仅仅需要jboss端可以访问的本地路径即可（如果本地址为空 将使用 caw.fileData.dbDoc.path 如果不是一部机器的情况下，这个的操作将影响速度）
caw.file.app.path=D:\\temp\\caw4

#请调整为对外的发布路径；一般是发邮件到客户，在邮件上有链接可以操作到M18系统，所以这里应该填一个外部访问的路径；
caw.web.url=http://www.abc.com/jsf/

#服务器内部资源访问路径
#本配置需要修改
caw.internal.url=@web_url

#系统将通过这个路径访问ws，推荐使用本机，如果在集群分工的情况下，可以合理分配服务器的使用，不过仍旧推荐使用本机。
#本配置不应该修改
caw.ws.url=@wsdl_url/jsf/rfws/

#共享文件夹（caw.file.app.path，caw.fileData.appDoc.path）文件的有效时间，根据最后修改时间算起，有效期单位是天；当这个数据没有填，或者填的不是数字，默认为30天，
caw.file.life.effect = 30

#M18系统使用的数据库ip地址
caw.database.ip=192.168.10.117

#M18系统使用的数据库端口
caw.database.port=3306

#M18系统使用的数据库名字
caw.database.dbname=nh7

#M18系统使用的数据库用户名
caw.database.user=nh7

#M18系统使用的数据库密码
caw.database.password=nh7@7jiaj


#AccessToken为空的时候,是不允许使用为登入模式访问系统。使用AccessToken访问，默认为admin用户。在开发时，推荐设置为简单的 例如ap，在正式使用的情况下，推荐设置为复杂 or 空
caw.ws.glAccessToken=iz

#本机可以跑定时任务，如果不为1 则不跑；
caw.sch.quartz = 1

#当caw.sch.quartz 不为1时，在本机发布任务，将会通过这个路径访问ws ，在目标机发布任务；目标机必须可以跑定时任务；
caw.sch.targetUrl = http://127.0.0.1:8080/jsf/rfws/
#target 机的caw.ws.glAccessToken
caw.sch.targetAccessToken=iz
</code></pre></div><ul><li>reset.caw</li></ul> <p>reset.caw放在jboss的config文件夹里面；用于开发环境，开发者可以在这里配置一些差数用于更方便开发；这里可以配制cawserver.properties 里面的参数，这里的配置会覆盖cawserver.properties 的配置；</p> <div class="language-xml extra-class"><pre class="language-xml"><code>#AP debug 模式,M18系统有一些功能是在apDebug模式下才能用的；这里设置为1启用apDebug模式
caw.ap.debug = 1
#在启动的时候 强制skip同步数据库结构（注意：可能会因为缺少表or字段导致部分功能不能运行）
caw.ap.skip.sycnDB=1

#下面几个参数，是用于将模块Check运行的信息打印在log中；module是注册哪些模块需要打印check信息，模块名称用“；”隔开，create，save，read，delete设置为1时，表示运行相应操作的checker时打印check信息；
caw.ap.debug.checker.create=0
caw.ap.debug.checker.save=0
caw.ap.debug.checker.read=0
caw.ap.debug.checker.delete=0
caw.ap.debug.checker.module=


#用于锁定job,可以锁定多个job，使用；隔开，被锁定的job只能被锁定job的服务器运行
caw.ap.sch.debugJobName=
#用于锁定jobGroup,可以锁定多个jobGroup，使用；隔开，被锁定的job只能被锁定job的服务器运行
caw.ap.sch.debugJobGroup=
#锁定job多久，单位是小时
caw.ap.sch.debugTime=

#如果设置为1跳过启动上传report format
caw.report.skipUploadFormat = 0

</code></pre></div><h3 id="表结构信息"><a href="#表结构信息" class="header-anchor">#</a> 表结构信息</h3> <p>对于M18的开发者而言，了解原本系统模块/功能的后台结构对于功能的开发是必须的资料。我们这里介绍如何在系统中找到表结构信息 以及如何使用api查找对应的表结构信息。</p> <p>在系统模块<code>数据字典</code>中可以找到对应菜单模块对应的表结构信息。</p> <p><img src="/assets/img/dd.844baa65.jpg" alt="mssst"></p> <p>在代码里面，已知table名字，获取信息</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DdTable</span> table <span class="token operator">=</span> <span class="token class-name">CawGlobal</span><span class="token punctuation">.</span><span class="token function">getDdTable</span><span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>遍历datadict信息</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Ehcache</span> cache <span class="token operator">=</span> <span class="token class-name">CawCache</span><span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token class-name">CawCache</span><span class="token punctuation">.</span>ddCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span> keys <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">DdTable</span> table <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DdTable</span><span class="token punctuation">)</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getObjectValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// add you code here</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="导入与导出"><a href="#导入与导出" class="header-anchor">#</a> 导入与导出</h3> <p>M18系统用户批量数据导入和导出的功能，用于数据初始化 临时备份 以及迁移准备等使用。</p> <ul><li>导出
M18系统支持将模块数据导出到excel文件，请查看数据导出模块；
如果开发者需要控制导出到excel文件的数据，可以在<a href="#module.xml">module.xml</a>配置对应模块的<code>IExcelGener</code>， excelGener=“class的完整路径” ， class需要实现<code>IExcelGener</code>接口；使用<code>exportData</code>方法用于导出数据包括excel文件的格式；<code>appendMoreData</code>方法用于拼接导出数据；</li></ul> <p>**注：**M18系统默认是用ExcelGener实现IExcelGener接口；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IExcelGener</span> <span class="token punctuation">{</span>
	\\生成不含数据用于导入数据准备的模板<span class="token class-name">Excel</span>
	<span class="token keyword">public</span> <span class="token class-name">Workbook</span> <span class="token function">createTemplate</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token keyword">long</span> beId<span class="token punctuation">,</span> <span class="token class-name">String</span> dataExportConfigJson<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
	\\将<span class="token class-name">SqlEntity</span>的数据生成<span class="token class-name">Excel</span>
	<span class="token keyword">public</span> <span class="token class-name">Workbook</span> <span class="token function">exportData</span><span class="token punctuation">(</span><span class="token class-name">DataExportConfig</span> config<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> entity<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>导入
M18系统支持模块数据从excel文件中导入，请查看数据导入模块；
如果开发者希望自己控制excel导入的数据处理，可以在<a href="#module.xml">module.xml</a>配置对应模块的IExcelGener和dataImportConveter；excelGener=“class的完整路径” ，class需要实现IExcelGener接口；dataImportConveter=“class的完整路径” ，class需要继承ImportConverterAdapter类；</li></ul> <p>使用<code>IExcelGener</code>的<code>createTemplate</code>方法创建导入数据的excel模板；使用<code>dataImportConveter</code>的convert方法将excel的数据转换成M18系统的SqlEntity结构；使用<code>getImportResultWriter</code>方法得到<code>ImportResultWriter</code>，用于将错误信息写到excel文件中；</p> <p>**注：**M18系统默认使用<code>EntityImportConverter</code>类转换导入的excel数据；使用ExcelImportResultWriter类将错误信息写到excel文件中；</p> <p>**注：**如果用户不重新定义<code>IExcelGener</code>和<code>dataImportConveter</code>的情况下，想干预导入功能，还有一个办法；</p> <p>在app.xml中定义标签entityHandler ，</p> <blockquote><p>entityHandler的参数介绍</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>string</td> <td>填模块的名称，如果为空，则这个entityHandler作用于所有模块</td></tr> <tr><td>className</td> <td>string</td> <td>class的完整路径，class需要继承EntityHandlerAdapter</td></tr></tbody></table> <p>下面entityHandler的这些方法都与导入有关</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImportSkipColumn</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token keyword">long</span> beId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">DdColumn</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImportExtraColumn</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token keyword">long</span> beId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleExtraBeforeAllColumn</span><span class="token punctuation">(</span><span class="token class-name">String</span> table<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateExtraColumnValue</span><span class="token punctuation">(</span><span class="token class-name">SqlEntity</span> entity<span class="token punctuation">,</span> <span class="token keyword">int</span> sqlTableRow<span class="token punctuation">,</span> <span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">String</span> tableName<span class="token punctuation">,</span> <span class="token class-name">DdColumn</span> ddColumn<span class="token punctuation">,</span> <span class="token class-name">Object</span> cellValue<span class="token punctuation">,</span> <span class="token keyword">long</span> beId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImportSkipTable</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token keyword">long</span> beId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">default</span> <span class="token class-name">String</span> <span class="token function">modifyColumnsRemark</span><span class="token punctuation">(</span><span class="token class-name">String</span> remark<span class="token punctuation">,</span> <span class="token class-name">String</span> tableName<span class="token punctuation">,</span> <span class="token class-name">DdColumn</span> col<span class="token punctuation">,</span> <span class="token class-name">DataExportConfig</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> remark<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>entityHandler关于导入的方法介绍</p></blockquote> <table><thead><tr><th>名称</th> <th>说明</th></tr></thead> <tbody><tr><td>getImportSkipColumn</td> <td>返回<code>Map&lt;String, Set&lt;String&gt;&gt;</code>；map的key是table name，set是field name的set；用于表示当前模块哪个table下的哪些field将不能使用导入功能</td></tr> <tr><td>getImportExtraColumn</td> <td>返回<code>Map&lt;String, Set&lt;String&gt;&gt;</code>；map的key是table name，list是DdColumn的List；用于表示当前模块哪个table需要加多一些field用与导入，这些field将会表现在导入模块界面栏位映射的组件上和显示在导入的模板excel上</td></tr> <tr><td>handleExtraBeforeAllColumn</td> <td>返回一个List，表示哪些额外加入的栏位，需要在所有栏位处理之前处理；</td></tr> <tr><td>updateExtraColumnValue</td> <td>用于处理额外加入的栏位值</td></tr> <tr><td>getImportSkipTable</td> <td>返回一个set表示当前模块哪些table将不能使用导入功能</td></tr> <tr><td>modifyColumnsRemark</td> <td>用于修改模板excel里面对模块栏位的说明</td></tr></tbody></table> <h3 id="文档打印"><a href="#文档打印" class="header-anchor">#</a> 文档打印</h3> <p>M18系统支持使用ireport进行文件打印的处理。系统通过jsper将对应的数据和格式生成pdf，并通过浏览器的查看PDF进行文件的查看并提供打印功能。</p> <blockquote><p>在开始打印的任何处理之前，请确保你对于ireport有一定的认识。</p></blockquote> <p>请在电脑中安装ireport的最新版本，并将M18中的com.jaspersoft.studio.data_6.2.0.final.jar替换到安装目录中。<strong>注</strong>:Ireport编辑软件是一个Eclipse.</p> <p>请将caw share的jar加入到<strong>JaspersoftStudio</strong>的项目中，以便系统在处理M18函数的时候可以给出正确提示。</p> <ul><li>编写 docReport.xml</li></ul> <blockquote><p>report属性说明</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td>字符</td> <td>用于唯一标示一个report。对应的code推荐以@开头</td></tr> <tr><td>module</td> <td>字符</td> <td>module.xml中的code，标示当前打印属于那个模块。允许设置多个模块，使用分号进行分割</td></tr> <tr><td>providerCode</td> <td>字符</td> <td>provider的class名字, 用户字段获取 数据获取 以及数据分析处理等。</td></tr> <tr><td>reportDto</td> <td>字符</td> <td>dto的class名字，用于处理打印参数。</td></tr> <tr><td>reportDtoSettingSrc</td> <td>字符</td> <td>用于指定设置页面的位置，一般对应的reoportdto的信息可以在这个页面进行设置。</td></tr> <tr><td>providerMess</td> <td>字符</td> <td>provider对应的MessCode</td></tr> <tr><td>providerOrder</td> <td>整数</td> <td>在一个模块有多个打印设置的时候有效，用于控制打印的次序</td></tr> <tr><td>apDebug</td> <td>布尔</td> <td>当设置为true的时候，仅仅debug模式可见</td></tr></tbody></table> <blockquote><p>format的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td>format的编号，对应的编号将在系统启动的时候生成一天format的记录，默认推荐编号和report的编号一致</td></tr> <tr><td>description</td> <td>format的说明字段</td></tr> <tr><td>remark</td> <td>format的详细说明字段</td></tr> <tr><td>packageName</td> <td>用于告知系统Jrxml存在的路径（代码路径）</td></tr></tbody></table> <blockquote><p>jrxml的属性描述</p></blockquote> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>jrxml的名字 推荐仅仅有字母组成 一般来说应该以Jrxml结尾</td></tr> <tr><td>main</td> <td>标记那个jrxml为主文件，在一个格式中有且仅有一个jrxml为主文件</td></tr></tbody></table> <p>resetData的属性描述</p> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>prCode</td> <td>provider的class名字, 作用于同一个provider的所有xml设定</td></tr> <tr><td>resetClass</td> <td>class类名，实现<code>CawJrPrintRestData</code>。用于修改已经创建的打印格式的数据获取过程，也可以给原本的格式添加额外的数据</td></tr></tbody></table> <p>reportHandler的属性描述</p> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>reportCode</td> <td>report的code栏位</td></tr> <tr><td>handlerClass</td> <td>class类名，实现<code>ReportHandler</code>。允许开发者将系统启动过程中初始化的jrxml格式进行进一步编辑。一般用于特定功能的隐藏。</td></tr></tbody></table> <p>reportShowHandler的属性描述</p> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>prCode</td> <td>provider的class名字, 作用于同一个provider的所有xml设定</td></tr> <tr><td>handlerClass</td> <td>class类名，实现<code>ReportShowHandler</code>。使得特定的打印功能可以控制pdf生成后是否直接下载or进行其他操作。</td></tr></tbody></table> <p>​</p> <blockquote><p>示例:</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>docReport</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>report</span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@bpm_emp<span class="token punctuation">&quot;</span></span>  
			<span class="token attr-name">reportDto</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.share.data.ireport.emp.EmpJrDto<span class="token punctuation">&quot;</span></span> <span class="token attr-name">reportDtoSettingSrc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/view/dialog/empPrintSetting.xhtml<span class="token punctuation">&quot;</span></span>
	        <span class="token attr-name">providerCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.ireport.provider.emp.EmployeeProvider<span class="token punctuation">&quot;</span></span> <span class="token attr-name">providerOrder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">providerMess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jr.emp_provider<span class="token punctuation">&quot;</span></span> <span class="token attr-name">apDebug</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	        
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>format</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@bpm_emp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">description</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Print<span class="token punctuation">&quot;</span></span> <span class="token attr-name">remark</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Print Employee<span class="token punctuation">&quot;</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.share.data.ireport.resource.emp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jrxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>emp.jrxml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">main</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jrxml</span><span class="token punctuation">&gt;</span></span>
	        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jrxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>empPic.jrxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jrxml</span><span class="token punctuation">&gt;</span></span>    
	        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jrxml</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>empUser.jrxml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jrxml</span><span class="token punctuation">&gt;</span></span>    
	     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>format</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>report</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>docReport</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>​</p> <ul><li>添加必要的Class以及Sql</li></ul> <blockquote><p>添加Dto class</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmpJrDto</span> <span class="token keyword">extends</span> <span class="token class-name">ModuleReportDto</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> prtPic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDefaultTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;Testing Ireport!&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isPrtPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> prtPic<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrtPic</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> prtPic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>prtPic <span class="token operator">=</span> prtPic<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到这仅仅一个简单的pojo 类，我们要求模块的dto均需要使用ModuleReportDto。</p> <blockquote><p>添加Provider</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ModuleProvider</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initReportStru</span><span class="token punctuation">(</span><span class="token class-name">CawReportDataSet</span> reData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// set table alias name</span>
		reData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;EMPLOYEE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		reData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		reData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;EMPLOYEEPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;employeepic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		reData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;PICUSER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		reData<span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">&quot;EMPLOYEE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">adjustData</span><span class="token punctuation">(</span><span class="token class-name">CawReportDataSet</span> reData<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		reData<span class="token punctuation">.</span><span class="token function">setRelationTo</span><span class="token punctuation">(</span><span class="token string">&quot;EMPLOYEE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DEPT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		reData<span class="token punctuation">.</span><span class="token function">setRelationTo</span><span class="token punctuation">(</span><span class="token string">&quot;EMPLOYEEPIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PICUSER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		reData<span class="token punctuation">.</span><span class="token function">assignSubReport</span><span class="token punctuation">(</span><span class="token string">&quot;EMPLOYEE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EMPLOYEEPIC&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">CawReportDataSet</span> <span class="token function">genIdsData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;{Call prtEmployee('&quot;</span> <span class="token operator">+</span> <span class="token function">getReportDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMainIdString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;')}&quot;</span><span class="token punctuation">;</span>

		<span class="token class-name">MacQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MacQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		query<span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">CawReportDataSet</span> ds <span class="token operator">=</span> <span class="token function">fillAndAdjustData</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> ds<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>sql例子</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> prtEmployee<span class="token punctuation">;</span>

<span class="token keyword">DELIMITER</span> $$

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> prtEmployee<span class="token punctuation">(</span> <span class="token operator">in</span> idStr <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
<span class="token keyword">BEGIN</span>
	
	<span class="token keyword">create</span> <span class="token keyword">temporary</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> prtemptempTable 
    <span class="token keyword">select</span> a<span class="token punctuation">.</span><span class="token operator">*</span>  
	<span class="token keyword">from</span> employee a
	<span class="token keyword">where</span> find_in_set<span class="token punctuation">(</span>a<span class="token punctuation">.</span>id<span class="token punctuation">,</span> idStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
   <span class="token comment">#create index</span>
	<span class="token keyword">create</span> <span class="token keyword">index</span> I_Employee_dept  <span class="token keyword">ON</span> prtemptempTable<span class="token punctuation">(</span>dept<span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">#main query 0</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> prtemptempTable<span class="token punctuation">;</span>
    
    <span class="token comment">#dept 1</span>
    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept a 
    <span class="token keyword">where</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token boolean">NULL</span> <span class="token keyword">from</span> prtemptempTable b <span class="token keyword">where</span> b<span class="token punctuation">.</span>dept<span class="token operator">=</span>a<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">drop</span> <span class="token keyword">table</span> prtemptempTable<span class="token punctuation">;</span>
<span class="token keyword">END</span>$$

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div><p><strong>注</strong>：Sql部分推荐使用select *以区别读取出尽量多的栏位。</p> <ul><li>启动Jboss(使用在JaspersoftStudio可以获取数据源)，编写JrXml</li></ul> <p>Jrxml推荐复制一个已有的进行修改，不推荐从零开始。除非你熟练掌握Ireport的相关技巧。</p> <p>创建一个数据源如下：</p> <p><img src="/assets/img/jr_ds1.e166b948.jpg" alt="mssst"></p> <p><img src="/assets/img/jr_ds2.34b79425.jpg" alt="mssst"></p> <p><strong>注</strong>：上图的URL为：http://127.0.0.1:8080/jsf/rfws/cawProvider/fields/com.multiable.ireport.provider.emp.EmployeeProvider?accessToken=iz&amp;lang=zh_CN</p> <p>accessToken 使用cawserver.properties 中的caw.ws.glAccessToken</p> <p>provider是上面xml中定义的名字</p> <p>lang 返回的field 说明mess 的语言（不传输的时候, 取GlobalOption的lang）</p> <p>skipLang 如果为true，返回的field 不会加上mess说明(可不传输,默认为false)</p> <p><strong>注</strong>：不限制使用(cawProvider/fields)这个ws，如果有需要，可以仿照CawJrProviderEJB自行处理</p> <p><strong>注</strong>：前面系统jboss的原因是为了可以使用这个URL</p> <p>创建这个新增一个Jrxml，使用read Fields即可以获取到当前</p> <ol><li><p>将jrxml放入代码,进一步编写xml 参照1.0只不过的说明和示例</p></li> <li><p>重启Jboss进行测试。</p> <p><img src="/assets/img/jr_pdf.09812cea.jpg" alt="mssst"></p></li></ol> <p><strong>注</strong>:目前系统在启动的时候将jrxml编译放到数据库里面，由于这个会受到数据量大小的影响启动时间，之后这部分将进行调整。</p> <h3 id="自定义模块"><a href="#自定义模块" class="header-anchor">#</a> 自定义模块</h3> <p>自定义模块的模块模板，开发者可以自定义模块模板，通过app.xml的template标签中module标签配置；</p> <blockquote><p>module标签参数</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>code</td> <td>true</td> <td>string</td> <td>模板的编号</td></tr> <tr><td>description</td> <td>true</td> <td>string</td> <td>模板的messCode</td></tr> <tr><td>module</td> <td>true</td> <td>string</td> <td>对应模板的模块名，对应的模块名在module.xml里面需要配置参数template=&quot;true&quot;</td></tr> <tr><td>helper</td> <td>true</td> <td>string</td> <td>填helper类的完成路径，需要继承CawUeHelper</td></tr> <tr><td><code>子标签&lt;page&gt;</code></td> <td>true</td> <td>string</td> <td>使用当前模板生成的自定义模块，模块的初始页面</td></tr> <tr><td><code>子标签&lt;setting&gt;</code></td> <td>true</td> <td>string</td> <td>当自定义模块选择当前设置的模板，这个标签配置的页面将会在自定义模块里面的模板选项中显示</td></tr></tbody></table> <p>helper类需要继承CawUeHelper</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FmTemplateHelper</span> <span class="token keyword">extends</span> <span class="token class-name">CawUeHelper</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">5554948686647491057L</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initModuleInfo</span><span class="token punctuation">(</span><span class="token class-name">SqlTable</span> ue<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token class-name">Module</span> <span class="token keyword">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token class-name">String</span> jsonStr <span class="token operator">=</span> ue<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token string">&quot;backEndInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringLib</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">FmtOption</span> option <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">,</span> <span class="token class-name">FmtOption</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">setUseAttach</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span><span class="token function">isSupportAttachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">setUseAttach</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">setFmShare</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="初始化数据"><a href="#初始化数据" class="header-anchor">#</a> 初始化数据</h3> <p>M18系统的数据库信息是通过代码自动生成的。所以开发者在数据库无法留存任何的预设数据。</p> <p>在app.xml定义一个entityDataInit。</p> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>entityDataInit的名字</td></tr> <tr><td>initDataCreator</td> <td>class类名，实现<code>InitDataCreator</code> 在对应的init方法中编写代码生成数据。</td></tr></tbody></table> <p><strong>注</strong>:这个方法每次Wildfly启动的时候都会运行，请自行绑定需要初始化的数据是否已经存在数据库中。</p> <blockquote><p>示例</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDriverCreator</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDataCreator</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasEntityData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Init test</span>
		<span class="token class-name">SqlEntity</span> entity <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
		<span class="token class-name">JdbcDriverEntity</span> accseeDriver <span class="token operator">=</span> <span class="token class-name">EntityLib</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> <span class="token class-name">JdbcDriverEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setJdbcType</span><span class="token punctuation">(</span><span class="token class-name">JdbcType<span class="token punctuation">.</span>Driver</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token string">&quot;net.test.jdbc.TestDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setGrammarType</span><span class="token punctuation">(</span><span class="token class-name">GrammarType</span><span class="token punctuation">.</span>UDF<span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setIndepPw</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setWithDbName</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		accseeDriver<span class="token punctuation">.</span><span class="token function">setConnStrTplt</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:test://${[@D_FilePath]};memory=false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">EntityLib</span><span class="token punctuation">.</span><span class="token function">mergeToEntity</span><span class="token punctuation">(</span>accseeDriver<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
		<span class="token function">update</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数据修复"><a href="#数据修复" class="header-anchor">#</a> 数据修复</h3> <p>在版本升级的过程中，系统有时候因为各种原因需要修正原本数据库中的数据。</p> <p>在app.xml定义一个dataFix。</p> <table><thead><tr><th>名字</th> <th>说明</th></tr></thead> <tbody><tr><td>className</td> <td>class类名，需要实现<code>DataFix</code>. 在run方法中处理需要的数据修复。<strong>注</strong>:这个同时也是唯一键，不要移动class位置</td></tr> <tr><td>ap</td> <td>注明对应的datafix负责的ap</td></tr> <tr><td>desc</td> <td>描述对应datafix修复的数据问题</td></tr> <tr><td>order</td> <td>用于定义datafix的运行顺序</td></tr></tbody></table> <blockquote><p>示例:</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataFix</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.ejb.bean.cache.datafix.TestToFix<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">desc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fix test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataFix</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestToFix</span> <span class="token keyword">extends</span> <span class="token class-name">DataFixAdapter</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token class-name">String</span> fixSql <span class="token operator">=</span> <span class="token string">&quot;update testinfo set myIdType = 'text'; &quot;</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">CawDs</span><span class="token punctuation">.</span><span class="token function">runUpdate</span><span class="token punctuation">(</span>fixSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">CawLog</span><span class="token punctuation">.</span><span class="token function">logException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注</strong>: 请尽量考虑可能存在的错误情况，避免数据修复没有正确运行。</p> <p><strong>注</strong>:请尽量编写数据修正的检查代码，而且数据修复的代码仅仅会运行一次。</p> <blockquote><p>系统判定表<code>datafix</code>中的记录来判定对应的fix是否已经运行。</p></blockquote> <h3 id="如何新增jar"><a href="#如何新增jar" class="header-anchor">#</a> 如何新增jar</h3> <p>为了确保在Wildfly在运行的时候可以获取到对应的第三方jar包，需要确保jar已经添加到Wildfly的运行环境中。</p> <p>M18推荐使用module.xml(wildfly)的方式来进行处理。 M18推荐同时修改<code>MANIFEST.MF</code>以及<code>jboss-deployment-structure.xml</code></p> <p><strong>注</strong>:在编译工具中(例：Eclipse)代码无错误，仅仅说明你的编译环境中包含需要的jar。并不是能够确保运行环境中 对应的代码可以执行。
<strong>注</strong>:Wildfly有自己的classloader管理方式。</p> <p><strong>注</strong>:由于在项目发布的时候，Wildfly会将ear下面的lib（或者war下面的lib）自动进行复制一份来进行运行。</p> <p>如果多次发布(系统重启)，会生成很多空间占用。</p> <p>具体请参考<a href="https://docs.jboss.org/author/display/WFLY8/Class+Loading+in+WildFly" target="_blank" rel="noopener noreferrer">Wildfly文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="定位启动错误"><a href="#定位启动错误" class="header-anchor">#</a> 定位启动错误</h3> <p>由于配置/jar/代码/系统环境等等原因，M18启动有时候会发生失败的情况。而启动后往往会发现很多不同的错误。请记得只理会第一个回答导致启动出错的Exception，并且修复这一个后重新启动看看。</p> <ul><li>千万不要从后往前找错误</li> <li>不要尝试一次过解决log里面提示的所有错误</li> <li>不要认定一定是代码上面的问题</li> <li>如果发现无足够的信息，推荐<code>print</code> log出来，就算是需要修改第三方的代码</li> <li>若是在Eclipse里面，启动出错的时候推荐删除所有断点</li></ul> <h3 id="定时任务"><a href="#定时任务" class="header-anchor">#</a> 定时任务</h3> <h4 id="创建定时任务"><a href="#创建定时任务" class="header-anchor">#</a> 创建定时任务</h4> <ul><li><p><strong>需要创建一个job 类</strong>：</p> <p>job类需要继承CawQuartzJob，只需实现doExecute 方法即可；</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncJob</span> <span class="token keyword">extends</span> <span class="token class-name">CawQuartzJob</span> <span class="token punctuation">{</span>
  
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> JOBGROUP <span class="token operator">=</span> <span class="token string">&quot;caw.sync&quot;</span><span class="token punctuation">;</span>
  
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token class-name">CheckMsg</span> <span class="token function">doExecute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">CawJobDto</span> dto<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         <span class="token comment">//do something	</span>

		<span class="token keyword">return</span> msg<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><strong>发布job</strong></p> <p>先构建一个CawJobDto 的对象，使用方法CawJobLib.scheduleJob(dto)发布即可， CawJobDto 有一个三个参数的构造方法，第一个是jobGroup ，第二个是当前entity的id，第三个是自己创建的job的class；jobGroup+ id 必须构建出一个唯一的jobName， 还有一个必须要填的是TimeScheduleDto，这个是time组件的dto，使用页面去配置生成或者自己new一个出来都可以；jobMess可以的也可以填；CawJobDto 里面还有一个jsonData， 可以填一些job需要的参数，doExeccute 时在 dto可以获取到；</p> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token class-name">CawJobDto</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CawJobDto</span><span class="token punctuation">(</span><span class="token class-name">SyncJob</span><span class="token punctuation">.</span>JOBGROUP<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token class-name">SyncJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		dto<span class="token punctuation">.</span><span class="token function">getJsonData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dto<span class="token punctuation">.</span><span class="token function">setTimeSchedule</span><span class="token punctuation">(</span>timeDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dto<span class="token punctuation">.</span><span class="token function">setJobMess</span><span class="token punctuation">(</span><span class="token string">&quot;syncJob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   

		<span class="token class-name">CawJobLib</span><span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​</p></li> <li><p>删除job</p> <p>使用 CawJobLib 中的 deleteJob 删除即可</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">CawJobDto</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CawJobDto</span><span class="token punctuation">(</span><span class="token class-name">UnlockUserJob</span><span class="token punctuation">.</span>JOBGROUP<span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getEntityId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UnlockUserJob</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CawJobLib</span><span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>​</p></li></ul> <h4 id="关于集群下面的说明"><a href="#关于集群下面的说明" class="header-anchor">#</a> 关于集群下面的说明</h4> <p>job被发布后，会把信息保存到cawjob表中；如果job过期了；会有定时任务将这些过期的job移除；</p> <p>只有当服务器的cawserver.properties配置了caw.sch.quartz = 1；这台服务器才能运行M18的job；</p> <p>如果开发者手动发布一个job在一台服务器，那么这个job只在这台服务器里跑，集群的其他服务器不会处理这个job；然后所有服务器每天每隔8小时会将本服务器运行job都移除，重新发布数库cawjob表中12个小时内会跑的job；这个时候集群服务器就会出现多台服务器抢一个job的情况，但是每一次都只会有一台服务器抢成功并运行这个job，其他服务器不运行；</p> <p>**注：**当服务器的caw.sch.quartz = 0时，这台服务器不会运行job；但是可以通过caw.sch.targetUrl 和caw.sch.targetAccessToken配置将从这台服务器发布的job指派给固定的服务器运行；在目标服务器发布job；目标服务器必须可以运行job；</p> <blockquote><p>cawserver.properties配置</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code>#本机可以跑定时任务，如果不为1 则不跑；
caw.sch.quartz = 1

#当caw.sch.quartz 不为1时，在本机发布任务，将会通过这个路径访问ws ，在目标机发布任务；目标机必须可以跑定时任务；
caw.sch.targetUrl = http://127.0.0.1:8080/jsf/rfws/
#target 机的caw.ws.glAccessToken
caw.sch.targetAccessToken=iz
</code></pre></div><h4 id="如何测试定时任务"><a href="#如何测试定时任务" class="header-anchor">#</a> 如何测试定时任务</h4> <p>如果在开发的过程中，想去debug一个job，但是可能其他人的服务器跟你用的是同一个的时候，就会出现抢运行job的情况；所有这个时候，可以使用开发者配置文件reset.caw里面的参数去锁定job只在本机运行；</p> <blockquote><p>reset.caw配置</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code>#用于锁定job,可以锁定多个job，使用；隔开，被锁定的job只能被锁定job的服务器运行
caw.ap.sch.debugJobName=caw.sync.1
#用于锁定jobGroup,可以锁定多个jobGroup，使用；隔开，被锁定的job只能被锁定job的服务器运行
caw.ap.sch.debugJobGroup=caw.sync
#锁定job多久，单位是小时
caw.ap.sch.debugTime=5
</code></pre></div><blockquote><p>定时任务使用数据库表介绍
创建定时任务
| 表名         | 说明                |
| ---------- | ----------------- |
| cawjob     | 存放定时任务发布的信息       |
| cawjoblog  | 存放定时任务运行过程的信息     |
| cawjoblock | 存放定时任务被那台服务器锁住的信息 |
关于集群下面的说明
如何测试定时任务</p></blockquote> <h3 id="文件流的处理方式"><a href="#文件流的处理方式" class="header-anchor">#</a> 文件流的处理方式</h3> <p>在之前描述<code>datadict</code>属性的时候，你应该发现在对应的属性里面无法处理文件流类型的东西。</p> <p>M18系统统一的文件流存储到<code>filedata</code>中。</p> <ul><li>同一个文件仅仅会对应<code>filedata</code>的一行记录，系统使用MD5+size来识别文件的唯一性</li> <li>保存在<code>filedata</code>的文件不提供删除功能</li> <li>为了避免用户遍历的方式读取出图片（图片存在不需要验证登陆的link），系统使用<code>imgcode</code></li></ul> <blockquote><p>文件的操作</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FileCurdEao</span> fileEao <span class="token operator">=</span> <span class="token class-name">JNDILocator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookupEJB</span><span class="token punctuation">(</span><span class="token class-name">FileCurdEao</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> byteArray <span class="token operator">=</span> <span class="token operator">*</span><span class="token operator">*</span>\\需要保存的<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
\\直接将内存的中的数据保存到db <span class="token punctuation">(</span>仅仅合适处理小文件<span class="token punctuation">)</span>
<span class="token keyword">long</span> fileId <span class="token operator">=</span> fileEao<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token string">&quot;pdf&quot;</span><span class="token punctuation">,</span> byteArray<span class="token punctuation">,</span> <span class="token string">&quot;work.pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> filePath <span class="token operator">=</span><span class="token operator">*</span><span class="token operator">*</span>\\需要保存的文件路径（服务器路径）
\\使用文件将数据保存到<span class="token class-name">DB</span>
fileId <span class="token operator">=</span> fileEao<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token string">&quot;pdf&quot;</span><span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> <span class="token string">&quot;work.pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

\\将已经保存的文件数据读取出来
<span class="token class-name">String</span> filePath_read <span class="token operator">=</span> fileEao<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>

\\如果你需要记录文件，那么将这个fileId保存起来即可
</code></pre></div><blockquote><p>图片的操作</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ImageLocal</span> imageEJB <span class="token operator">=</span> <span class="token class-name">JNDILocator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookupEJB</span><span class="token punctuation">(</span><span class="token string">&quot;ImageEJB&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ImageLocal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>\\需要处理的图片文件

\\将图片保存 获取imgcode
<span class="token class-name">String</span> imgcode <span class="token operator">=</span> imageEJB<span class="token punctuation">.</span><span class="token function">uploadImage</span><span class="token punctuation">(</span><span class="token string">&quot;imgName&quot;</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

\\通过key重新获取到图片文件
<span class="token class-name">File</span> img <span class="token operator">=</span> imageEJB<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span>imgcode<span class="token punctuation">,</span> flase<span class="token punctuation">)</span><span class="token punctuation">;</span>
\\第二个参数为ture的时候默认返回缩略图，推荐尽量使用获取缩略图

\\如果你需要记录图片，那么将这个imgcode保存起来即可
</code></pre></div><h3 id="集群cache同步"><a href="#集群cache同步" class="header-anchor">#</a> 集群Cache同步</h3> <p>CawCache，主要是存放一些从配置读取的内容，和一些从数据库读取出来的不会频繁修改的数据(避免多次查询数据库)；现在系统中Datadict，Mess， 模块的SqlEntity等数据都是使用了CawCache存放数据.</p> <h4 id="使用cawcache"><a href="#使用cawcache" class="header-anchor">#</a> 使用CawCache</h4> <p>开发者想要添加一种Cache，可以使用CawCache的方法添加；请查看CawCache的addSelfPopulatingCache方法</p> <p>然后使用CawCache的putObject 或者remove方法，去操作cache中的数据；</p> <p>通过CawCache 的getObject方法，可以拿到cache的数据</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一个参数是cache的名字，第二个参数是指cache最多有多少个，第三个参数是指cache没被使用多久后就会失效（单位是秒）；第4个参数如果为true，则读取这个cache的时候要复制一个object出来返回</span>
<span class="token class-name">CawCache</span><span class="token punctuation">.</span><span class="token function">addSelfPopulatingCache</span><span class="token punctuation">(</span>navMenu<span class="token punctuation">,</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">getBaseCacheSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">86400</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NavmenuEntryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第一个参数是已注册的cache名字；第二个参数是要放入到这个cache的缓存的key，需要是可序列化的key；第三个参数是要放入到这个cache的缓存内容</span>
<span class="token class-name">CawCache</span><span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>cawcheName<span class="token punctuation">,</span> key<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第一个参数是已注册的cache名字；第二个参数是这个cache里面缓存的key，</span>
<span class="token class-name">MenuItemConfig</span> menuCfg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MenuItemConfig</span><span class="token punctuation">)</span> <span class="token class-name">CawCache</span><span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">CawCache</span><span class="token punctuation">.</span>menuCache<span class="token punctuation">,</span> menukey<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第一个参数是已注册的cache名字；第二个参数是这个cache里面缓存的key，</span>
<span class="token class-name">CawCache</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">CawCache</span><span class="token punctuation">.</span>userSettingCache<span class="token punctuation">,</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="集群里面的注意事项"><a href="#集群里面的注意事项" class="header-anchor">#</a> 集群里面的注意事项</h4> <p>在集群的情况下，由于数据的修改，缓存就有可能出现不同步的现象；</p> <p>**注1：**使用cache的时候必须考虑好如何同步数据，不然将会出现无法预测的问题（不单单针对CawCache）</p> <p>**注2：**并不是所有的缓存都需要同步</p> <p>现在推荐使用以下的两种方式去同步缓存；</p> <ul><li><p><strong>默认同步缓存方法</strong></p> <p>推荐用法：cache的内容简单，只对CawCache做简单的put或delete;</p> <p>请使用 CawClusterLib 的方法 callCawCacheClusterEvent</p></li></ul> <p>增加集群缓存</p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">CawClusterCacheDto</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CawClusterCacheDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	dto<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">UseInfoCache</span><span class="token punctuation">.</span>CACHE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	dto<span class="token punctuation">.</span><span class="token function">getCacheMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>menuCode<span class="token punctuation">,</span> uic<span class="token punctuation">)</span><span class="token punctuation">;</span>
	dto<span class="token punctuation">.</span><span class="token function">setCacheClass</span><span class="token punctuation">(</span><span class="token class-name">UseInfoCache</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">CawClusterLib</span><span class="token punctuation">.</span><span class="token function">callCawCacheClusterEvent</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>删除集群缓存</p> <div class="language-java extra-class"><pre class="language-java"><code>      <span class="token class-name">CawClusterCacheDto</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CawClusterCacheDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dto<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">UdfLogic</span><span class="token punctuation">.</span>CACHE_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      dto<span class="token punctuation">.</span><span class="token function">getDeleteKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">CawClusterLib</span><span class="token punctuation">.</span><span class="token function">callCawCacheClusterEvent</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>CawClusterCacheDto 介绍：</p></blockquote> <table><thead><tr><th>参数名</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>name</td> <td>String</td> <td>需要同步的cache的名字</td></tr> <tr><td>cacheMap</td> <td>Map&lt;Serializable, Object&gt;</td> <td>这个map中缓存的值将会添加到集群的其他机器中，map存的是缓存的key-value 结构</td></tr> <tr><td>cacheClass</td> <td>Class&lt;?&gt;</td> <td>cacheMap中value的class类型</td></tr> <tr><td>deleteKeys</td> <td><code>Set&lt;Serializable&gt;</code></td> <td>集群的其他机器将会移除的缓存，set存的是缓存的key</td></tr></tbody></table> <ul><li><p><strong>自定义同步缓存方法</strong></p> <p>需要同步CawCache或者一些静态的Map，Collection等缓存，有些缓存可能不是简单的添加或删除，或者需要同时操作几种不同的缓存，那么就需要自定义class去处理了；</p> <p>​</p></li></ul> <p>在app.xml中配置标签clusterListerner</p> <blockquote><p>clusterListerner标签参数介绍</p></blockquote> <table><thead><tr><th>名字</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>eventType</td> <td>string</td> <td>同步缓存的类型</td></tr> <tr><td>className</td> <td>string</td> <td>这里填class的完整路径；同步缓存的处理class，class 需要继承CawClusterListenerAdapter，并实现run方法</td></tr></tbody></table> <p><strong>使用自定义方法同步缓存</strong></p> <p>在需要同步集群缓存的地方调用CawClusterLib 的callClusterEvent方法；然后其他集群的机器就会运行对应Listener的run方法了：</p> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token class-name">JSONObject</span> jo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jo<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">,</span> <span class="token class-name">JsfCache</span><span class="token punctuation">.</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jo<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cacheKey&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> action<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">ActionParam</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//一个参数是xml配置的eventType；第二个参数是String，一般是传一个json，集群服务器拿到这个参数后会传给clusterListerner的run方法；</span>
		<span class="token class-name">CawClusterLib</span><span class="token punctuation">.</span><span class="token function">callClusterEvent</span><span class="token punctuation">(</span><span class="token class-name">CawClusterEvent</span><span class="token punctuation">.</span>JSFCACHE<span class="token punctuation">,</span> jo<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="object共享"><a href="#object共享" class="header-anchor">#</a> Object共享</h3> <p>M18系统支持不同系统之间进行数据共享；一般是一些设置模块使用；使用数据共享要在app.xml中配置标签dataObject；</p> <blockquote><p>dataShare标签介绍</p></blockquote> <table><thead><tr><th>名字</th> <th>必填</th> <th>类型</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>className</td> <td>true</td> <td>string</td> <td></td> <td>填class的完成路径，class必须继承ModuleObjectHandler</td></tr></tbody></table> <blockquote><p>dataObject 配置例子</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataObject</span>  <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.multiable.core.ejb.bean.dataobject.handler.ComboObjectHandler<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataObject</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>DataObjectHandler 例子</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComboObjectHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ModuleObjectHandler</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;comboData&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMenuCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;comboData&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;comboData&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;comboData&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getInfoMessList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> messList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		messList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;dataObject.comboDataInfo1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> messList<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDepends</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> depends <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getDepends</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		depends<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;udfMess&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> depends<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ModuleObjectHandler  是实现了DataObjectHandler接口的，下面是DataObjectHandler部分方法介绍</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataObjectHandler</span> <span class="token punctuation">{</span>

	<span class="token comment">//导入object上传文件后会运行这个方法，可以通过覆写这个方法干预entity的生成</span>
	<span class="token keyword">public</span> <span class="token class-name">DataObjectBaseDto</span> <span class="token function">restoreDsDto</span><span class="token punctuation">(</span><span class="token class-name">DsEntryObject</span> entryObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
  	<span class="token comment">//导出object的时候，可以通过覆写这个方法，将一些图片文件类的信息写到导出的Object里面；</span>
	<span class="token keyword">public</span> <span class="token class-name">DsEntryObject</span> <span class="token function">genDsEntry</span><span class="token punctuation">(</span><span class="token class-name">DataObjectBaseDto</span> dto<span class="token punctuation">)</span><span class="token punctuation">;</span>

  	<span class="token comment">//导出object的时候，可以通过覆写这个方法去干预entity的导出</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fillupDto</span><span class="token punctuation">(</span><span class="token class-name">DataObjectBaseDto</span> dto<span class="token punctuation">,</span> <span class="token class-name">DataShareObjectDto</span> dsDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//导入object进行安装的时候，可以通过覆写这个方法，干预object的安装</span>
	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">CheckMsg</span><span class="token punctuation">&gt;</span></span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token keyword">long</span> beId<span class="token punctuation">,</span> <span class="token class-name">DataObjectBaseDto</span> dsDto<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DsInstallDto</span><span class="token punctuation">&gt;</span></span> insList<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> depMapping<span class="token punctuation">,</span> <span class="token class-name">Object</span> detail<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="常用工具类"><a href="#常用工具类" class="header-anchor">#</a> 常用工具类</h2> <h3 id="基本操作"><a href="#基本操作" class="header-anchor">#</a> 基本操作</h3> <table><thead><tr><th>类</th> <th>说明</th></tr></thead> <tbody><tr><td><code>ArrayLib</code></td> <td>处理数据的工具类；值得注意的方法 1.检查数组中是否包含有一个字符串，2.合并数组</td></tr> <tr><td><code>ClassLib</code></td> <td>处理Class的工具类；主要提供了方法 1.根据class路径或者Class&lt;?&gt; 获取类名， 2. 获取class 的Field  3. 获取class 的方法 4.获取class 的类型</td></tr> <tr><td><code>DateLib</code></td> <td>处理Date value的工具类；主要提供的方法 1 获取最大时间和最小时间，2 比较两个时间相差多少，3 对date value 进行加减，4根据String 创建Date， 5获取当前时间和一些转换date类型的方法</td></tr> <tr><td><code>DateFormatLib</code></td> <td>处理Date类型转换的工具类；主要提供的方法 1 将Date 根据dateFormat 转换成对应的String ，2 将String 根据dateFormat 转换成Date类型</td></tr> <tr><td><code>ListLib</code></td> <td>处理List 的工具类；主要提供的方法有 1 获取new List，2 判断List是否为空， 3 判断两个List是否一样，4 List的排序，5获取一个Object 的Field 的Value List</td></tr> <tr><td><code>MathLib</code></td> <td>提供数学计算的工具类；主要提供的方法有 1 对小数的四舍五入，接近的最大整数，接近的最小整数， 2 选取一串数字中最大数，最小数 ，3 获取一串数字的平均值，总和，4 获取绝对值 5 转换String 成 int，Double</td></tr> <tr><td><code>StringLib</code></td> <td>处理String 的工具类；主要提供的方法有 ：1获取唯一的String， 2检查String是否相等，是否为空 ， 3按照不同的方案剪切String 4 按照不同的方案加上String 或者替换String ，5 提供转换size 成 MB，KB的方法 ， 6 将String 中的字符替换成 HTML 的格式</td></tr></tbody></table> <h3 id="特定操作"><a href="#特定操作" class="header-anchor">#</a> 特定操作</h3> <table><thead><tr><th>类</th> <th>说明</th></tr></thead> <tbody><tr><td><code>SqlTableLib</code></td> <td>实现SqlTable的表内操作，以及SqlTable到POJO或JSON字符串的相互转换；主要提供的方法有： 1对比两个SqlTable 是否相等， 2 将一个SqlTable 中的一行复制到另一个SqlTable， 3 SqlTable 与PoO 之间的相互装换，4  SqlTable 与 Json 字符串之间的相互装换</td></tr> <tr><td><code>CheckMsgLib</code></td> <td>处理CheckMsg 的工具类；主要提供的方法有 1 提供创建CheckMsg 的方法， 2将CheckMsg 和Json String 相互转换 ，3 根据CheckResult 创建ResponseBuilder ，4 将 jsonObject 或SqlTable 转换成jsonString 后放入Response 中返回 ，5创建错误信息的Response</td></tr> <tr><td><code>ConvertLib</code></td> <td>转换对象的类型的工具类；主要提供的方法 1. 转换Obeject 成 Boolean，String，Double，Long，Integer，Number，Date ， 2.将String 转换成对象的Object 类型，例如Date，Number，Boolean</td></tr> <tr><td><code>CawLib</code></td> <td>获取caw配置信息的工具类；主要提供了方法 1. 获取服务器ip地址，2.获取cawserver.properties配置文件信息，3. 获取唯一的key</td></tr></tbody></table> <blockquote><p>发送邮件示例</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EJB</span><span class="token punctuation">(</span>beanName <span class="token operator">=</span> <span class="token string">&quot;MacEmailSenderEJB&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">MacEmailSenderLocal</span> emailEJB<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token class-name">MacEmail</span> email <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MacEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MacEmailAttachment</span> atta <span class="token operator">:</span> <span class="token function">getAttachments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  email<span class="token punctuation">.</span><span class="token function">addAttachment</span><span class="token punctuation">(</span>atta<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

email<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token string">&quot;test@mac.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
email<span class="token punctuation">.</span><span class="token function">setCc</span><span class="token punctuation">(</span><span class="token string">&quot;test1@mac.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
email<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;sunject - test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
email<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&quot;conent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CheckResult</span> result <span class="token operator">=</span> emailEJB<span class="token punctuation">.</span><span class="token function">sendEmailWithId</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> emailSettingId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
</code></pre></div><p><strong>注</strong>:emailSettingId是邮件服务器设定的Id，如果不传输将使用默认格式。</p> <blockquote><p>审核追踪示例</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuditTrailData</span><span class="token punctuation">&gt;</span></span> datas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">AuditTrailData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuditTrailData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setEntityId</span><span class="token punctuation">(</span>entityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setExeTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setiRev</span><span class="token punctuation">(</span>iRev<span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setMenuCode</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setModuleName</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setOperation</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">setOperationDesc</span><span class="token punctuation">(</span><span class="token string">&quot;failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

datas<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">AuditTrailLib</span><span class="token punctuation">.</span><span class="token function">addAuditTrail</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注</strong>：start是代码开始运行时的时间戳。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cac8883f.js" defer></script><script src="/assets/js/2.09bf837d.js" defer></script><script src="/assets/js/20.d4c305df.js" defer></script>
  </body>
</html>
