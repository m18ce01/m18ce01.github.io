<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BPM Extension Interface | M18 Developer Center</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Make Something People Want">
    
    <link rel="preload" href="/assets/css/0.styles.42bf6aee.css" as="style"><link rel="preload" href="/assets/js/app.b34f3491.js" as="script"><link rel="preload" href="/assets/js/2.cb189d69.js" as="script"><link rel="preload" href="/assets/js/39.aa2cbcf4.js" as="script"><link rel="prefetch" href="/assets/js/10.5e7f1fce.js"><link rel="prefetch" href="/assets/js/100.f2c35eb0.js"><link rel="prefetch" href="/assets/js/101.3ba2ce11.js"><link rel="prefetch" href="/assets/js/102.26446061.js"><link rel="prefetch" href="/assets/js/103.9dbe04c2.js"><link rel="prefetch" href="/assets/js/104.1627ee70.js"><link rel="prefetch" href="/assets/js/105.1dbb3400.js"><link rel="prefetch" href="/assets/js/106.a317fd14.js"><link rel="prefetch" href="/assets/js/107.629bc651.js"><link rel="prefetch" href="/assets/js/108.e5b7ab35.js"><link rel="prefetch" href="/assets/js/109.a6fc34d9.js"><link rel="prefetch" href="/assets/js/11.e3795c97.js"><link rel="prefetch" href="/assets/js/110.9d5bfe33.js"><link rel="prefetch" href="/assets/js/111.34b52d07.js"><link rel="prefetch" href="/assets/js/112.7b98cc2d.js"><link rel="prefetch" href="/assets/js/113.a652ac95.js"><link rel="prefetch" href="/assets/js/114.42b2aaa3.js"><link rel="prefetch" href="/assets/js/12.2fbb93f8.js"><link rel="prefetch" href="/assets/js/13.d9ab7373.js"><link rel="prefetch" href="/assets/js/14.df82f67f.js"><link rel="prefetch" href="/assets/js/15.cd8667e0.js"><link rel="prefetch" href="/assets/js/16.33a328e1.js"><link rel="prefetch" href="/assets/js/17.ce10b4fe.js"><link rel="prefetch" href="/assets/js/18.7d9d9cac.js"><link rel="prefetch" href="/assets/js/19.85756027.js"><link rel="prefetch" href="/assets/js/20.5802449c.js"><link rel="prefetch" href="/assets/js/21.329ffcf0.js"><link rel="prefetch" href="/assets/js/22.ab07f3e0.js"><link rel="prefetch" href="/assets/js/23.e290e136.js"><link rel="prefetch" href="/assets/js/24.dc43483c.js"><link rel="prefetch" href="/assets/js/25.aed70204.js"><link rel="prefetch" href="/assets/js/26.6556c32c.js"><link rel="prefetch" href="/assets/js/27.a1fd810c.js"><link rel="prefetch" href="/assets/js/28.33fb9dc3.js"><link rel="prefetch" href="/assets/js/29.da8e84d1.js"><link rel="prefetch" href="/assets/js/3.248b64f8.js"><link rel="prefetch" href="/assets/js/30.3a3dca91.js"><link rel="prefetch" href="/assets/js/31.c95e7b26.js"><link rel="prefetch" href="/assets/js/32.9bd968e1.js"><link rel="prefetch" href="/assets/js/33.2e92d6ff.js"><link rel="prefetch" href="/assets/js/34.e1c52542.js"><link rel="prefetch" href="/assets/js/35.6943a822.js"><link rel="prefetch" href="/assets/js/36.6ef6ba60.js"><link rel="prefetch" href="/assets/js/37.3eeaa27e.js"><link rel="prefetch" href="/assets/js/38.0aff1a5f.js"><link rel="prefetch" href="/assets/js/4.487402b9.js"><link rel="prefetch" href="/assets/js/40.5c33ec20.js"><link rel="prefetch" href="/assets/js/41.da5fea06.js"><link rel="prefetch" href="/assets/js/42.a227add0.js"><link rel="prefetch" href="/assets/js/43.628f56d0.js"><link rel="prefetch" href="/assets/js/44.f8490e5a.js"><link rel="prefetch" href="/assets/js/45.29060e01.js"><link rel="prefetch" href="/assets/js/46.56a8dfee.js"><link rel="prefetch" href="/assets/js/47.81c5a441.js"><link rel="prefetch" href="/assets/js/48.2f368e4a.js"><link rel="prefetch" href="/assets/js/49.f49abf36.js"><link rel="prefetch" href="/assets/js/5.d9ab1698.js"><link rel="prefetch" href="/assets/js/50.7508da80.js"><link rel="prefetch" href="/assets/js/51.a2e9ad6e.js"><link rel="prefetch" href="/assets/js/52.135f84d1.js"><link rel="prefetch" href="/assets/js/53.591382f9.js"><link rel="prefetch" href="/assets/js/54.e14111e4.js"><link rel="prefetch" href="/assets/js/55.5cc510a8.js"><link rel="prefetch" href="/assets/js/56.3435c212.js"><link rel="prefetch" href="/assets/js/57.09a4571b.js"><link rel="prefetch" href="/assets/js/58.9f555ca6.js"><link rel="prefetch" href="/assets/js/59.f1164768.js"><link rel="prefetch" href="/assets/js/6.9a8f234f.js"><link rel="prefetch" href="/assets/js/60.122184a1.js"><link rel="prefetch" href="/assets/js/61.23b7c2cf.js"><link rel="prefetch" href="/assets/js/62.ba8881de.js"><link rel="prefetch" href="/assets/js/63.bb79f730.js"><link rel="prefetch" href="/assets/js/64.9ad8d26f.js"><link rel="prefetch" href="/assets/js/65.5af54a96.js"><link rel="prefetch" href="/assets/js/66.89ab5907.js"><link rel="prefetch" href="/assets/js/67.cd497bc9.js"><link rel="prefetch" href="/assets/js/68.888ea6f9.js"><link rel="prefetch" href="/assets/js/69.b611671b.js"><link rel="prefetch" href="/assets/js/7.bbdc4d5e.js"><link rel="prefetch" href="/assets/js/70.3f68c17d.js"><link rel="prefetch" href="/assets/js/71.9f682829.js"><link rel="prefetch" href="/assets/js/72.1ab26f47.js"><link rel="prefetch" href="/assets/js/73.acb32385.js"><link rel="prefetch" href="/assets/js/74.b763af56.js"><link rel="prefetch" href="/assets/js/75.23d0ef82.js"><link rel="prefetch" href="/assets/js/76.919edc27.js"><link rel="prefetch" href="/assets/js/77.a8b71be9.js"><link rel="prefetch" href="/assets/js/78.065b726d.js"><link rel="prefetch" href="/assets/js/79.e6050046.js"><link rel="prefetch" href="/assets/js/8.f44dcd36.js"><link rel="prefetch" href="/assets/js/80.6e29bed9.js"><link rel="prefetch" href="/assets/js/81.659aa98d.js"><link rel="prefetch" href="/assets/js/82.a0ff2102.js"><link rel="prefetch" href="/assets/js/83.a6734ad7.js"><link rel="prefetch" href="/assets/js/84.c9aed91f.js"><link rel="prefetch" href="/assets/js/85.dae6f6fa.js"><link rel="prefetch" href="/assets/js/86.1f3d693c.js"><link rel="prefetch" href="/assets/js/87.d2557e5d.js"><link rel="prefetch" href="/assets/js/88.af275cc3.js"><link rel="prefetch" href="/assets/js/89.f4334771.js"><link rel="prefetch" href="/assets/js/9.36b17444.js"><link rel="prefetch" href="/assets/js/90.a4770600.js"><link rel="prefetch" href="/assets/js/91.1f40afa4.js"><link rel="prefetch" href="/assets/js/92.8fab88b9.js"><link rel="prefetch" href="/assets/js/93.9d2c1633.js"><link rel="prefetch" href="/assets/js/94.4f902bd0.js"><link rel="prefetch" href="/assets/js/95.554766fa.js"><link rel="prefetch" href="/assets/js/96.a751244f.js"><link rel="prefetch" href="/assets/js/97.b698f6c8.js"><link rel="prefetch" href="/assets/js/98.75392a85.js"><link rel="prefetch" href="/assets/js/99.8d12eb8a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.42bf6aee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">M18 Developer Center</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/tutorial/" class="nav-link">
  Tutorial
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebServices" class="dropdown-title"><span class="title">WebServices</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebServices" class="mobile-dropdown-title"><span class="title">WebServices</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/api/m18/" class="nav-link">
  M18
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ce01/" class="nav-link">
  M18 ERP
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ch01/" class="nav-link">
  M18 HCM
</a></li></ul></div></div><div class="nav-item"><a href="/en/m18/" class="nav-link router-link-active">
  App
</a></div><div class="nav-item"><a href="/zh-CN/" class="nav-link">
  中文文档
</a></div><div class="nav-item"><a href="https://community.multiable.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Community
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/tutorial/" class="nav-link">
  Tutorial
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebServices" class="dropdown-title"><span class="title">WebServices</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebServices" class="mobile-dropdown-title"><span class="title">WebServices</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/api/m18/" class="nav-link">
  M18
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ce01/" class="nav-link">
  M18 ERP
</a></li><li class="dropdown-item"><!----> <a href="/en/api/ch01/" class="nav-link">
  M18 HCM
</a></li></ul></div></div><div class="nav-item"><a href="/en/m18/" class="nav-link router-link-active">
  App
</a></div><div class="nav-item"><a href="/zh-CN/" class="nav-link">
  中文文档
</a></div><div class="nav-item"><a href="https://community.multiable.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Community
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>BPM Extension Interface</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/m18/m18bpmapp.html#what-can-i-do" class="sidebar-link">What can I do?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/en/m18/m18bpmapp.html#bpmhandler" class="sidebar-link">BpmHandler</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/m18/m18bpmapp.html#_1-extend-the-source-of-participants" class="sidebar-link">1.  Extend the source of Participants</a></li><li class="sidebar-sub-header"><a href="/en/m18/m18bpmapp.html#_2-extend-the-relationship-of-participants" class="sidebar-link">2. Extend the relationship of Participants</a></li><li class="sidebar-sub-header"><a href="/en/m18/m18bpmapp.html#_3-extend-the-parameters-used-in-the-condition" class="sidebar-link">3. Extend the parameters used in the Condition</a></li><li class="sidebar-sub-header"><a href="/en/m18/m18bpmapp.html#_4-extend-the-parameters-used-in-the-formula" class="sidebar-link">4. Extend the parameters used in the Formula</a></li><li class="sidebar-sub-header"><a href="/en/m18/m18bpmapp.html#_5-add-action-before-workflow-submit" class="sidebar-link">5. Add action before workflow submit</a></li><li class="sidebar-sub-header"><a href="/en/m18/m18bpmapp.html#_6-add-action-after-changenote-approved" class="sidebar-link">6. Add action after ChangeNote approved</a></li></ul></li><li><a href="/en/m18/m18bpmapp.html#bpm-event-listener" class="sidebar-link">Bpm Event Listener</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="bpm-extension-interface"><a href="#bpm-extension-interface" class="header-anchor">#</a> BPM Extension Interface</h1> <p><code>Version: 1.0 | Release Date: 30/9/2019</code></p> <h2 id="what-can-i-do"><a href="#what-can-i-do" class="header-anchor">#</a> What can I do?</h2> <ol><li>Extend the source and relationship of participants</li> <li>Extend the parameters used in the Formula</li> <li>Extend the parameters used in Condition</li> <li>Add action before submit</li> <li>Add action after ChangeNote approved</li> <li>Monitor all events in the workflow</li></ol> <h2 id="bpmhandler"><a href="#bpmhandler" class="header-anchor">#</a> BpmHandler</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BpmHandler</span> <span class="token punctuation">{</span>

	<span class="token comment">/*return key,mess */</span>
	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">extendDynamicPatorSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">extendDynamicPatorShip</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/* return target user id*/</span>
	<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtendPatorSourceValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> srcField<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtendPatorShipValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> ship<span class="token punctuation">,</span> <span class="token keyword">long</span> uid<span class="token punctuation">,</span> <span class="token keyword">long</span> empId<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtendPatorShipValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> ship<span class="token punctuation">,</span> <span class="token keyword">long</span> uid<span class="token punctuation">,</span> <span class="token keyword">long</span> empId<span class="token punctuation">,</span> <span class="token keyword">long</span> reportingLineId<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/*exclude lookup=user,employee field which default as source*/</span>
	<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">excludeDynamicPatorSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/*return entity identify for bpm */</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getEntityIdentify</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// such as ce01 business rule</span>
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span> <span class="token function">extendDynamicField</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span> <span class="token function">dynamicFieldCurrentValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">changeNoteApproved</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> origin<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> changeNote<span class="token punctuation">,</span> <span class="token class-name">String</span> changeNoteCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// return empty string means ok</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkBeforeSubmit</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-extend-the-source-of-participants"><a href="#_1-extend-the-source-of-participants" class="header-anchor">#</a> 1.  Extend the source of Participants</h3> <p><img src="/assets/img/bpm1.e0854439.jpg" alt="bpm1">
extendDynamicPatorSource</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">extendDynamicPatorSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> extendSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		extendSource<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e_source<span class="token punctuation">,</span> <span class="token string">&quot;wf.extendA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> extendSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>getExtendPatorSourceValue</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtendPatorSourceValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> srcField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> targetUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span><span class="token function">getModuleType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>e_source<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>srcField<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Long</span> publiserId <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getMainData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;createUid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			targetUser<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>publiserId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> targetUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-extend-the-relationship-of-participants"><a href="#_2-extend-the-relationship-of-participants" class="header-anchor">#</a> 2. Extend the relationship of Participants</h3> <p><img src="/assets/img/bpm2.d599178e.jpg" alt="bpm2"></p> <p>extendDynamicPatorShip</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">extendDynamicPatorShip</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> extendSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		extendSource<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e_ship<span class="token punctuation">,</span> <span class="token string">&quot;wf.extendShip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> extendSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>getExtendPatorShipValue</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Keep this method for backward compatibility</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Deprecated</span>
<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtendPatorShipValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> ship<span class="token punctuation">,</span> <span class="token keyword">long</span> uid<span class="token punctuation">,</span> <span class="token keyword">long</span> empId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> targetUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span><span class="token function">getModuleType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>e_ship<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ship<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				targetUser<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>empId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// found user id by employee id</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> targetUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>new method contains a new parameter <code>reportingLineId</code>, If you implement both methods at the same time, only new methods will be called</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">getExtendPatorShipValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> ship<span class="token punctuation">,</span> <span class="token keyword">long</span> uid<span class="token punctuation">,</span> <span class="token keyword">long</span> empId<span class="token punctuation">,</span> <span class="token keyword">long</span> reportingLineId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-extend-the-parameters-used-in-the-condition"><a href="#_3-extend-the-parameters-used-in-the-condition" class="header-anchor">#</a> 3. Extend the parameters used in the Condition</h3> <p><img src="/assets/img/bpm3.a9e8edcc.jpg" alt="bpm3"></p> <h3 id="_4-extend-the-parameters-used-in-the-formula"><a href="#_4-extend-the-parameters-used-in-the-formula" class="header-anchor">#</a> 4. Extend the parameters used in the Formula</h3> <p><img src="/assets/img/bpm4.ca9e19a6.jpg" alt="bpm4"></p> <p>extendDynamicField</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span> <span class="token function">extendDynamicField</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span> ef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DynamicField</span> f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicField</span><span class="token punctuation">(</span><span class="token string">&quot;fA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;messA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DynamicField</span> f2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicField</span><span class="token punctuation">(</span><span class="token string">&quot;fB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;messB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		ef<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		ef<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> ef<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>dynamicFieldCurrentValue</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span> <span class="token function">dynamicFieldCurrentValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span> ef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DynamicField</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">DynamicField</span> f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicField</span><span class="token punctuation">(</span><span class="token string">&quot;fA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;messA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">DynamicField</span> f2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicField</span><span class="token punctuation">(</span><span class="token string">&quot;fB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;messB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		f1<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;AAAAA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		f2<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">&quot;BBBBB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		ef<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		ef<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> ef<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-add-action-before-workflow-submit"><a href="#_5-add-action-before-workflow-submit" class="header-anchor">#</a> 5. Add action before workflow submit</h3> <p>If the returned result is not an empty string, the submit process is aborted and the returned result is displayed to the user.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkBeforeSubmit</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;employee2&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">CawLib</span><span class="token punctuation">.</span><span class="token function">isApDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">CawGlobal</span><span class="token punctuation">.</span><span class="token function">getMess</span><span class="token punctuation">(</span><span class="token string">&quot;wf.actionFailInfo2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">checkBeforeSubmit</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-add-action-after-changenote-approved"><a href="#_6-add-action-after-changenote-approved" class="header-anchor">#</a> 6. Add action after ChangeNote approved</h3> <p>After the changenote is approved, we will use the changenote to overwrite the original record.
This method will be called before the overwrite, and the return result indicates whether the overwrite process will be processed after this method.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">changeNoteApproved</span><span class="token punctuation">(</span><span class="token class-name">String</span> moduleName<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> origin<span class="token punctuation">,</span> <span class="token class-name">SqlEntity</span> changeNote<span class="token punctuation">,</span> <span class="token class-name">String</span> changeNoteCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="bpm-event-listener"><a href="#bpm-event-listener" class="header-anchor">#</a> Bpm Event Listener</h2> <p>On the BPM interface, you can configure different response actions according to different events.
If you want to capture these events at the code level and perform corresponding operations, please see below.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@CawEventListener</span><span class="token punctuation">(</span>eventTopic <span class="token operator">=</span> <span class="token class-name">WfTopic<span class="token punctuation">.</span>BpmEvent</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AncmBpmEventListener</span> <span class="token keyword">extends</span> <span class="token class-name">CawListenerAdapter</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">callEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>param <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>param <span class="token keyword">instanceof</span> <span class="token class-name">WfPublishPara</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">WfPublishPara</span> msg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WfPublishPara</span><span class="token punctuation">)</span> param<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;ancm&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getApvModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token class-name">WfInsState</span><span class="token punctuation">.</span>ENDED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getWfInsState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">long</span> ancmId <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getApvRecordId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">CheckMsg</span> ckmsg <span class="token operator">=</span> <span class="token class-name">AncmUtil</span><span class="token punctuation">.</span><span class="token function">publishAncmBpm</span><span class="token punctuation">(</span>ancmId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ckmsg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">CawLog</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ckmsg<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b34f3491.js" defer></script><script src="/assets/js/2.cb189d69.js" defer></script><script src="/assets/js/39.aa2cbcf4.js" defer></script>
  </body>
</html>
